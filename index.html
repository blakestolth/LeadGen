<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Vancouver Island Credit | Auto Approvals Online — Work with Blake</title>

  <meta name="description" content="Fast, confidential auto approvals across Vancouver Island & BC. New & used options. Delivery to your door. Work 1 on 1 with Blake Stolth — no call centres." />
  <link rel="canonical" href="https://vancouverislandcredit.ca/"/>
  <meta property="og:title" content="Vancouver Island Credit — Auto Approvals Online"/>
  <meta property="og:description" content="Get approved online. New & used inventory across Vancouver Island & BC. Delivery to your door. Work directly with Blake."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://vancouverislandcredit.ca/"/>
  <meta property="og:image" content="https://vancouverislandcredit.ca/0041B99D-D49A-4024-AA7A-2786A4605342.jpg"/>
  <meta name="theme-color" content="#2A5D9F"/>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --blue-600:#2A5D9F; --blue-700:#214B80; --blue-100:#EAF1FB; --blue-grad:#4C7CC0;

      /* Scaled sizes you approved */
      --fs-h1: 20px; --fs-h2: 16px; --fs-body: 13px; --fs-label: 11px; --fs-cta: 13px;
      --pad-y: 10px; --gap-regular: 8px; --input-py: 5px; --input-px: 10px; --radius: 10px;
      --nav-font: 14px;
      --control-h: 40px;
      --field-gap: 8px;
      --section-max: 720px;

      --aside-pad: 16px;

      /* Tighter standard gap beneath footer bar (brought box bottom up) */
      --footer-card-gap: 4px;
    }
    @media (max-width:640px){ :root{ --nav-font: 13px; } }

    body{ font-family:'Inter',sans-serif; background:#f6f7fb; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .card{ background:#fff; border-radius:12px; border:1px solid #e5e7eb; box-shadow:0 8px 18px -10px rgb(0 0 0 / .15); }

    /* Accented cards (applied to all major boxes) */
    .card-accent{
      border:2px solid rgba(42,93,159,.18);
      box-shadow:0 14px 26px -18px rgba(42,93,159,.38);
      background:
        linear-gradient(180deg,rgba(246,248,253,0.55),rgba(255,255,255,1)) border-box;
    }
    .accent-header{
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid #e5e7eb; padding:10px 12px;
      background:linear-gradient(180deg,#f9fbff 0%, #ffffff 100%);
      border-top-left-radius:12px; border-top-right-radius:12px;
    }

    .h1{ font-size:var(--fs-h1); font-weight:800; color:#0f172a; }
    .h2{ font-size:var(--fs-h2); font-weight:800; color:#0f172a; margin-bottom:4px; }
    .label{ font-size:var(--fs-label); color:#3f3f46; font-weight:600; display:block; margin-bottom:6px; }

    .form-input,.form-select,.form-textarea{
      background:#f3f4f6; color:#18181b; border:1.5px solid #e5e7eb; font-size:var(--fs-body); width:100%;
      padding:var(--input-py) var(--input-px); border-radius:var(--radius); transition:all .15s ease;
      min-height: var(--control-h); line-height: 1.2;
    }
    .form-input::placeholder{ color:#6b7280; }
    .form-input:focus,.form-select:focus,.form-textarea:focus{ background:#fff; border-color:var(--blue-600); box-shadow:0 0 0 3px rgba(42,93,159,.15); outline:none; }

    .cta-button{ background:var(--blue-600); color:#fff; font-weight:800; padding:.5rem .9rem; border-radius:.7rem; font-size:var(--fs-cta); min-height:36px; }
    .cta-button:hover{ background:var(--blue-700); }

    .track{ height:6px; background:#e5e7eb; border-radius:9999px; overflow:hidden; }
    .fill{ height:6px; background:linear-gradient(90deg,var(--blue-600),var(--blue-grad)); border-radius:9999px; width:0%; transition:width .25s ease; }

    .err{ border-color:#ef4444 !important; } .err-label{ color:#ef4444 !important; }

    /* ---------- FORM BOX-SPECIFIC DOWNSCALE ---------- */
    #lead-form{
      --fs-h2: 15px;          /* was 16 */
      --fs-body: 12px;        /* was 13 */
      --fs-label: 10px;       /* was 11 */
      --fs-cta: 12px;         /* was 13 */
      --control-h: 38px;      /* was 40 */
    }
    #lead-form .choice-rect{ padding:9px 11px; }
    #lead-form .sticky [id^="progress-"]{ font-size:10px !important; }
    #lead-form .cta-button{ min-height:34px; }

    /* --------------------- Form shell (consistent footer placement) --------------------- */
    .form-shell{ position:relative; overflow:hidden; display:flex; flex-direction:column; }
    .form-shell .sticky{ position:sticky; top:0; z-index:10; background:#fff; pointer-events:none; }

    .step-viewport{ flex:1; overflow:auto; }
    .step-viewport-inner{ height:100%; }

    .step-inner{
      max-width: var(--section-max); margin: 0 auto; padding-top: var(--pad-y);
      padding-bottom: var(--footer-space, 12px); /* tighter inner buffer */
      display:flex; flex-direction:column; min-height:100%;
    }
    .step-title{}
    .step-body{
      flex:1; display:flex; align-items:center; justify-content:center;
      padding-top:4px;
      min-height: var(--content-min, 0px);
    }
    .step-body > .content{ width:100%; max-width:640px; margin:0 auto; }
    .vstack > * + *{ margin-top: var(--gap-regular); }

    .form-footer{
      position: sticky; bottom: 0; background:#fff; border-top:1px solid #e5e7eb;
      padding: 12px 16px;
      margin-bottom: var(--footer-card-gap);
    }
    #btnBack{ min-height:34px; border-radius:10px; }

    .choice-rect{
      width:100%; text-align:left; border:1.5px solid #e5e7eb; border-radius:10px; background:#fff;
      font-weight:700; color:#111827; transition:all .15s ease; display:block; cursor:pointer;
    }
    .choice-rect:hover{ border-color:var(--blue-600); background:#f5f8ff; }
    .choice-rect.selected{ border-color:var(--blue-600); background:#eef4ff; box-shadow:inset 0 0 0 2px var(--blue-600); }

    .muted{ font-size:10px; color:#6b7280; }

    .seg{ display:inline-flex; align-items:center; gap:6px; background:#f3f4f6; border:1.5px solid #e5e7eb; border-radius:9999px; padding:4px; margin-top:4px; }
    .seg-btn{ appearance:none; border:0; background:transparent; cursor:pointer; padding:6px 12px; border-radius:9999px; font-weight:800; font-size:12px; color:#374151; transition:background .15s ease, color .15s ease, box-shadow .15s ease; }
    .seg-btn[aria-pressed="true"]{ background:var(--blue-600); color:#fff; box-shadow:0 1px 2px rgba(0,0,0,.06); }

    .grid-inline-2{ display:grid; grid-template-columns: 1fr 1fr; gap:var(--field-gap); }
    .grid-inline-3{ display:grid; grid-template-columns: 1fr 1.3fr 1fr; gap:var(--field-gap); }
    .grid-inline-3-tight{ display:grid; grid-template-columns: .65fr 1.1fr 1.3fr; gap:var(--field-gap); }
    .grid-inline-addr1{ display:grid; grid-template-columns: 3fr 1fr; gap:var(--field-gap); }
    .grid-inline-addr2{ display:grid; grid-template-columns: 1.6fr 1fr 1fr; gap:var(--field-gap); }
    .grid-inline-dob{ display:grid; grid-template-columns: 1.2fr .9fr .9fr 1.6fr; gap:var(--field-gap); }

    .brand-left{ display:flex; align-items:center; gap:12px; }
    .site-logo{ height:60px; width:auto; object-fit:contain; display:block; transform:translateY(-1px); }
    @media (max-width:640px){ .site-logo{ height:56px; } }
    .brand-stack{ display:flex; flex-direction:column; gap:4px; }
    .brand-title{ color:#0f172a; font-weight:800; letter-spacing:-0.01em; font-size:var(--nav-font); white-space:nowrap; text-decoration:none; line-height:1.1; margin-left:-2px; }
    .powered-by-inline{ display:flex; align-items:center; gap:6px; font-size: calc(var(--nav-font) * .8); color:#475569; font-weight:700; line-height:1; }
    .powered-by-inline img{ height: 0.9em; width:auto; object-fit:contain; position:relative; top:2px; }

    .abc-badge{ display:inline-flex; align-items:center; justify-content:center; width:20px; height:20px; border-radius:9999px; background:var(--blue-600); color:#fff; border:none; font-weight:800; font-size:11px; line-height:1; flex-shrink:0; }

    .bodytype-card{ overflow:hidden; border-radius:10px; border:1px solid #e5e7eb; background:#fff; transition:transform .15s,box-shadow .15s,border-color .15s; }
    .bodytype-card:hover{ transform:translateY(-1px); border-color:var(--blue-600); box-shadow:0 10px 18px -12px rgba(42,93,159,.28); }
    .bodytype-img{ background:#e5e7eb center/cover no-repeat; height:92px; }
    @media (min-width:640px){ .bodytype-img{ height:110px; } }

    .map-embed{ width:100%; height:150px; border:0; }
    @media (max-width:768px){ .map-embed{ height:200px; } }
    .progress-overlay{position:fixed;inset:0;background:rgba(15,23,42,.55);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:50}
    .progress-card{background:#fff;border-radius:12px;box-shadow:0 20px 40px -20px rgba(0,0,0,.35);width:min(520px,92vw);padding:18px 16px}
    .progress-title{font-weight:800;font-size:16px;color:#0f172a}
    .progress-track{height:8px;background:#e5e7eb;border-radius:9999px;overflow:hidden;margin-top:10px}
    .progress-bar{height:8px;width:0%;background:linear-gradient(90deg,var(--blue-600),var(--blue-grad));transition:width .6s ease}
    .progress-steps{list-style:none;padding:0;margin:12px 0 0;font-size:13px;color:#374151}
    .progress-steps li{display:flex;align-items:center;gap:8px;opacity:.7}
    .progress-steps li.active{opacity:1;font-weight:700}
    .progress-note{margin-top:10px;font-size:12px;color:#64748b}
    .hidden{display:none !important;}

    .form-select{
      -webkit-appearance: none; -moz-appearance: none; appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, #9ca3af 50%),
        linear-gradient(135deg, #9ca3af 50%, transparent 50%),
        linear-gradient(to right, transparent, transparent);
      background-position:
        calc(100% - 18px) calc(50% - 5px),
        calc(100% - 13px) calc(50% - 5px),
        calc(100% - 2.2rem) 0.4rem;
      background-size: 7px 7px, 7px 7px, 0 0;
      background-repeat: no-repeat;
      padding-right: 2.2rem;
    }

    /* Refi calculator — compact */
    .refi-card { padding: var(--aside-pad); }
    .refi-title { font-size: var(--fs-h2); font-weight: 800; color:#0f172a; line-height:1.2; }
    .refi-grid{ display:grid; grid-template-columns: 1fr; gap:8px; align-items:center; }
    .refi-row{ display:grid; grid-template-columns: 1.5fr .6fr .7fr; gap:8px; }
    .refi-mini{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
    .refi-results{ font-size:12px; line-height:1.15; color:#0f172a; font-weight:600; display:grid; gap:4px; min-width:150px; }
    .refi-slider{ width:100%; accent-color: var(--blue-600); }
    .refi-note{ font-size:10px; color:#6b7280; margin-top:2px; text-align:right; }

    /* ---- HEADER LOGIN INPUTS ---- */
    .nav-input{
      min-height:30px; font-size:12px; padding:4px 8px; border-radius:8px;
      background:#f3f4f6; border:1.5px solid #e5e7eb; width:180px;
    }
    .nav-input:focus{ background:#fff; border-color:var(--blue-600); box-shadow:0 0 0 3px rgba(42,93,159,.15); outline:none; }
    .nav-login-btn{ min-height:30px; padding:6px 12px; border-radius:8px; font-size:12px; font-weight:800; background:var(--blue-600); color:#fff; }
    .nav-login-btn:hover{ background:var(--blue-700); }
    .nav-forgot{ font-size:11px; color:#475569; }
    .nav-forgot:hover{ color:var(--blue-600); text-decoration:underline; }
    .nav-profile{
      display:inline-flex; align-items:center; justify-content:center;
      width:34px; height:34px; border-radius:9999px; border:1px solid #e5e7eb; background:#fff;
    }
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"AutoDealer",
    "name":"Vancouver Island Credit",
    "telephone":"+1-236-969-2424",
    "address":{"@type":"PostalAddress","streetAddress":"525 Gorge Rd E","addressLocality":"Victoria","addressRegion":"BC","postalCode":"V8T 4T2","addressCountry":"CA"},
    "areaServed":"British Columbia, Canada",
    "image":"https://vancouverislandcredit.ca/0041B99D-D49A-4024-AA7A-2786A4605342.jpg",
    "url":"https://vancouverislandcredit.ca",
    "slogan":"Get approved online. Delivery across BC. Work directly with Blake.",
    "founder":{"@type":"Person","name":"Blake Stolth"},
    "makesOffer":[{"@type":"Offer","itemOffered":{"@type":"Service","name":"Auto Financing (New & Used)"}}]
  }
  </script>
</head>
<body>
  <!-- NAV -->
  <header class="w-full max-w-5xl mx-auto mt-4 px-4">
    <nav class="bg-white/90 backdrop-blur card card-accent px-4 sm:px-6 py-2.5 flex items-center justify-between gap-4">
      <div class="brand-left">
        <img src="Logo.png" alt="Vancouver Island Credit logo" class="site-logo"/>
        <div class="brand-stack">
          <a href="#" class="brand-title" aria-label="Vancouver Island Credit — Home">Vancouver Island Credit</a>
          <div class="powered-by-inline"><span>Powered by</span><img src="Equifax.png" alt="Equifax"/></div>
        </div>
      </div>

      <!-- RIGHT INLINE MENU + HEADER LOGIN (no dropdowns) -->
      <div class="hidden lg:flex items-center gap-4">
        <a href="#inventory" class="font-semibold text-zinc-700 hover:text-[var(--blue-600)]">Inventory</a>
        <a href="#about" class="font-semibold text-zinc-700 hover:text-[var(--blue-600)]">About</a>
        <a href="#contact" class="font-semibold text-zinc-700 hover:text-[var(--blue-600)]">Contact</a>
        <a href="#lead-form" class="cta-button !py-1.5">Apply Now</a>

        <!-- stacked username/password -->
        <form id="header-login-form" class="flex flex-col gap-1 ml-2">
          <input id="hdrUser" name="username" class="nav-input" placeholder="Username" autocomplete="username" />
          <input id="hdrPass" name="password" class="nav-input" placeholder="Password" type="password" autocomplete="current-password" />
        </form>

        <!-- login + forgot, to the right -->
        <div class="flex flex-col items-start gap-1">
          <button type="submit" form="header-login-form" class="nav-login-btn">Login</button>
          <a href="#" class="nav-forgot">Forgot password?</a>
        </div>

        <!-- profile icon -->
        <a href="#profile" class="nav-profile" aria-label="Profile">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-zinc-700" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5.121 17.804A9 9 0 1119.78 6.34 9 9 0 015.12 17.804z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 11a3 3 0 10-6 0 3 3 0 006 0z"/>
          </svg>
        </a>
      </div>

      <!-- Mobile menu button (kept, but no dropdowns inside header itself) -->
      <button id="menuBtn" class="lg:hidden inline-flex items-center justify-center h-9 w-9 rounded-md border border-zinc-200" aria-label="Open menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-zinc-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </nav>

    <!-- Simple mobile links (no dropdown logic beyond reveal) -->
    <div id="mobileMenu" class="hidden lg:hidden mt-2 card card-accent px-4 py-3">
      <div class="flex flex-col gap-2 font-semibold text-zinc-700">
        <a href="#inventory" class="py-2 px-2 rounded hover:bg-[var(--blue-100)]">Inventory</a>
        <a href="#about" class="py-2 px-2 rounded hover:bg-[var(--blue-100)]">About</a>
        <a href="#contact" class="py-2 px-2 rounded hover:bg-[var(--blue-100)]">Contact</a>
        <a href="#lead-form" class="mt-1 cta-button text-center">Apply Now</a>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="w-full max-w-5xl mx-auto px-4 py-6 space-y-6">
    <!-- HERO / ABOUT -->
    <section id="about" class="card card-accent p-5">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="vstack">
          <h1 class="h1">Get driving in 3 easy steps</h1>
          <ol class="text-[12px] text-zinc-700 space-y-2">
            <li class="flex items-start gap-2">
              <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[var(--blue-600)] text-white font-extrabold text-[11px]">1</span>
              <span><b>Enter your info</b> — 2–3 minutes, no pressure.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[var(--blue-600)] text-white font-extrabold text-[11px]">2</span>
              <span><b>See options you qualify for</b> across BC.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[var(--blue-600)] text-white font-extrabold text-[11px]">3</span>
              <span><b>We deliver</b> to your door — fast &amp; stress-free.</span>
            </li>
          </ol>
        </div>
        <div class="vstack">
          <h2 class="h2">Why people pick us</h2>
          <ul class="text-[12px] text-zinc-700 space-y-2">
            <li class="flex items-start gap-2"><span class="abc-badge">A</span><span><b>All credit welcome:</b> high approval rates.</span></li>
            <li class="flex items-start gap-2"><span class="abc-badge">B</span><span><b>Bigger selection:</b> new &amp; used vehicles across BC.</span></li>
            <li class="flex items-start gap-2"><span class="abc-badge">C</span><span><b>Contact from us:</b> no information sold to dealerships.</span></li>
            <li class="flex items-start gap-2"><span class="abc-badge">D</span><span><b>Delivery across BC:</b> right to your doorstep.</span></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- FORM + RIGHT COLUMN -->
    <section class="grid md:grid-cols-2 gap-4">
      <!-- FORM -->
      <div class="card card-accent p-0 overflow-hidden" id="lead-form">
        <div class="form-shell" id="form-shell">
          <!-- progress -->
          <div class="sticky px-4 py-2 border-b">
            <div class="flex items-center justify-between">
              <div id="progress-label" class="text-[10px] font-semibold text-zinc-700">Step 1</div>
              <div id="progress-endcap" class="text-[10px] text-[var(--blue-700)] font-semibold">Let’s get you approved</div>
            </div>
            <div class="track mt-2"><div id="progress-fill" class="fill"></div></div>
          </div>

          <!-- STEP VIEWPORT -->
          <div id="step-viewport" class="step-viewport px-4">
            <div class="step-viewport-inner">
              <form id="the-form" name="lead-form" method="POST" data-netlify="true" data-netlify-honeypot="bot-field" action="/thank-you.html" novalidate>
                <input type="hidden" name="form-name" value="lead-form"/>
                <input type="hidden" name="app_type" id="app_type" value="Full Application" />
                <input type="hidden" name="appCode" id="appCode" value="" />
                <input type="hidden" name="intent" id="intent" value="finance" />
                <p class="hidden" aria-hidden="true"><label>Don’t fill this out: <input name="bot-field"/></label></p>

                <!-- 1. Intent -->
                <section class="form-step" data-id="step-intent">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">1. What are you looking to do?</h3></div>
                    <div class="step-body">
                      <div class="content vstack" style="max-width:560px;">
                        <button type="button" class="choice-rect" data-intent="finance">Finance a vehicle</button>
                        <button type="button" class="choice-rect" data-intent="refinance">Refinance current vehicle</button>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 2. Vehicle condition (finance only) -->
                <section class="form-step hidden" data-id="step-cond">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">2. Vehicle condition</h3></div>
                    <div class="step-body">
                      <div class="content vstack">
                        <button type="button" class="choice-rect" data-cond="New">New</button>
                        <button type="button" class="choice-rect" data-cond="Used">Used</button>
                        <button type="button" class="choice-rect" data-cond="Both">Both</button>
                        <input type="hidden" name="vehicleCondition" id="vehicleCondition">
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 3. Budget (finance only) -->
                <section class="form-step hidden" data-id="step-budget">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">3. Bi-weekly budget <span class="muted">(starts at $120)</span></h3></div>
                    <div class="step-body">
                      <div class="content" style="max-width:560px;">
                        <input id="biWeeklyRange" type="range" min="120" max="600" step="10" value="250" class="w-full" style="accent-color: var(--blue-600);">
                        <div class="text-[10px] text-zinc-700 mt-1 text-center">Selected: <b>$<span id="biWeeklyOut">250</span></b> / bi-weekly</div>
                        <input type="hidden" name="budgetRange" id="budgetRange" value="$250 bi-weekly">
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 4a. Finance: Purchase -->
                <section class="form-step hidden" data-id="step-purchase">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">4. Purchase details</h3></div>
                    <div class="step-body">
                      <div class="content vstack" style="max-width:560px;">
                        <div>
                          <label for="downPayment" class="label">Down payment</label>
                          <select id="downPayment" name="downPayment" class="form-select">
                            <option value="">Select…</option>
                            <option>$3,000+</option>
                            <option>$1,000–$3,000</option>
                            <option>$0–$1,000</option>
                          </select>
                        </div>
                        <div>
                          <label class="label">Trade-in</label>
                          <div class="grid-inline-2">
                            <button type="button" class="choice-rect" data-trade="No">No</button>
                            <button type="button" class="choice-rect" data-trade="Yes">Yes</button>
                          </div>
                          <input type="hidden" id="hasTradeIn" name="hasTradeIn" value="No">
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 4b. Refinance: combined vehicle + loan -->
                <section class="form-step hidden" data-id="step-refi-details">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">4. Refinance details</h3></div>
                    <div class="step-body">
                      <div class="content vstack" style="max-width:640px;">
                        <div class="grid-inline-3-tight">
                          <select name="refiYear" id="refiYear" class="form-select" required>
                            <option value="">Year</option>
                          </select>
                          <input type="text" name="refiMake" id="refiMake" placeholder="Make" class="form-input" maxlength="40" required/>
                          <input type="text" name="refiModel" id="refiModel" placeholder="Model" class="form-input" maxlength="50" required/>
                        </div>
                        <div class="grid-inline-2">
                          <select id="refiRemainYears" name="refiRemainYears" class="form-select" required>
                            <option value="">Years left</option>
                            <option>1</option><option>2</option><option>3</option><option>4</option>
                            <option>5</option><option>6</option><option>7</option><option>8</option>
                          </select>
                          <input type="text" id="refiCurrentRate" name="refiCurrentRate" class="form-input" placeholder="Current interest % (e.g., 9.49)" inputmode="decimal" maxlength="6" required/>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 5. Trade-in details (finance only & only if Yes) -->
                <section class="form-step hidden" data-id="step-tradein">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">5. Trade-in details</h3></div>
                    <div class="step-body">
                      <div class="content">
                        <div class="grid-inline-3-tight mt-2">
                          <select name="tradeInYear" id="tradeInYear" class="form-select">
                            <option value="">Year</option>
                          </select>
                          <input type="text" name="tradeInMake" id="tradeInMake" placeholder="Make" class="form-input" maxlength="40"/>
                          <input type="text" name="tradeInModel" id="tradeInModel" placeholder="Model" class="form-input" maxlength="50"/>
                        </div>
                        <div class="grid-inline-2 mt-2">
                          <input type="number" name="tradeInKms" id="tradeInKms" placeholder="Km" class="form-input" inputmode="numeric" min="0" max="1000000"/>
                          <input type="text" name="tradeInOwed" id="tradeInOwed" placeholder="Money owed e.g. $5,000 or None" class="form-input" maxlength="20"/>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 6. Employment + monthly income -->
                <section class="form-step hidden" data-id="step-income">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">6. Employment &amp; Income</h3></div>
                    <div class="step-body">
                      <div class="content vstack" style="max-width:560px;">
                        <div>
                          <label for="incomeSourceFull" class="label">Employment type <span class="text-red-500">*</span></label>
                          <select id="incomeSourceFull" name="incomeSourceFull" class="form-select" required>
                            <option value="">Select…</option>
                            <option value="Full-Time">Full-Time</option>
                            <option value="Part-Time">Part-Time</option>
                            <option value="Self-Employed">Self-Employed</option>
                            <option value="Disability">Disability</option>
                            <option value="Other">Other</option>
                          </select>
                        </div>
                        <div>
                          <label for="avgMonthlyIncome" class="label">Monthly income (pre-tax) <span class="text-red-500">*</span></label>
                          <input type="text" id="avgMonthlyIncome" name="avgMonthlyIncome" class="form-input" placeholder="$4,000" inputmode="numeric" maxlength="16" required/>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 7. Account -->
                <section class="form-step hidden" data-id="step-account">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">7. Account creation</h3></div>
                    <div class="step-body">
                      <div class="content vstack" style="max-width:560px;">
                        <div>
                          <label for="email" class="label">Email <span class="text-red-500">*</span></label>
                          <input type="email" id="email" name="email" class="form-input" autocomplete="email" maxlength="100" required/>
                        </div>
                        <div>
                          <label for="phone" class="label">Phone number <span class="text-red-500">*</span></label>
                          <input type="tel" id="phone" name="phone" class="form-input" autocomplete="tel" inputmode="tel" maxlength="14" required/>
                        </div>
                        <div>
                          <label for="accountPass" class="label">Password <span class="text-red-500">*</span></label>
                          <input type="password" id="accountPass" name="accountPass" class="form-input" minlength="6" maxlength="64" required/>
                        </div>
                        <div>
                          <label for="accountPass2" class="label">Re-enter password <span class="text-red-500">*</span></label>
                          <input type="password" id="accountPass2" name="accountPass2" class="form-input" minlength="6" maxlength="64" required/>
                          <div id="passMatchMsg" class="muted hidden">Passwords must match.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 8. Your info -->
                <section class="form-step hidden" data-id="step-yourinfo">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">8. Your information</h3></div>
                    <div class="step-body">
                      <div class="content vstack" style="max-width:640px;">
                        <div class="grid-inline-3">
                          <div>
                            <label for="firstName" class="label">First name <span class="text-red-500">*</span></label>
                            <input type="text" id="firstName" name="firstName" class="form-input" autocomplete="given-name" maxlength="50" required/>
                          </div>
                          <div>
                            <label for="middleName" class="label">Middle name(s)</label>
                            <input type="text" id="middleName" name="middleName" class="form-input" autocomplete="additional-name" maxlength="100"/>
                          </div>
                          <div>
                            <label for="lastName" class="label">Last name <span class="text-red-500">*</span></label>
                            <input type="text" id="lastName" name="lastName" class="form-input" autocomplete="family-name" maxlength="50" required/>
                          </div>
                        </div>

                        <div class="grid-inline-dob mt-1">
                          <div>
                            <label class="label">DOB Year <span class="text-red-500">*</span></label>
                            <select id="dobYear" name="dobYear" class="form-select" required></select>
                          </div>
                          <div>
                            <label class="label">Month <span class="text-red-500">*</span></label>
                            <select id="dobMonth" name="dobMonth" class="form-select" required><option value="">MM</option></select>
                          </div>
                          <div>
                            <label class="label">Day <span class="text-red-500">*</span></label>
                            <select id="dobDay" name="dobDay" class="form-select" required><option value="">DD</option></select>
                          </div>
                          <div>
                            <label for="maritalStatus" class="label">Marital</label>
                            <select id="maritalStatus" name="maritalStatus" class="form-select">
                              <option value="">Select</option>
                              <option>Single</option><option>Married</option><option>Common-Law</option>
                              <option>Divorced</option><option>Separated</option><option>Widowed</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 9. Address -->
                <section class="form-step hidden" data-id="step-address">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">9. Current address</h3></div>
                    <div class="step-body">
                      <div class="content" style="max-width:640px;">
                        <div class="grid-inline-addr1 mt-2">
                          <input type="text" id="currentStreetAddress" name="currentStreetAddress" class="form-input" placeholder="Street address" autocomplete="street-address" maxlength="120" required/>
                          <input type="text" id="currentUnit" name="currentUnit" class="form-input" placeholder="Unit #" maxlength="10"/>
                        </div>
                        <div class="grid-inline-addr2 mt-2">
                          <input type="text" id="currentCity" name="currentCity" class="form-input" placeholder="City" autocomplete="address-level2" maxlength="60" required/>
                          <select id="currentProvince" name="currentProvince" class="form-select" required><option value="">Prov</option></select>
                          <input type="text" id="currentPostalCode" name="currentPostalCode" class="form-input" placeholder="Postal code" autocomplete="postal-code" maxlength="7" required/>
                        </div>
                        <div class="grid-inline-2 mt-2">
                          <div>
                            <label for="housingPayment" class="label">Monthly payments</label>
                            <input type="text" id="housingPayment" name="housingPayment" class="form-input" placeholder="$1,800" inputmode="numeric" maxlength="16" required/>
                          </div>
                          <div>
                            <label class="label">Time at address</label>
                            <div class="grid-inline-2">
                              <select id="timeAtAddressYears" name="timeAtAddressYears" class="form-select"><option value="">Years</option></select>
                              <select id="timeAtAddressMonths" name="timeAtAddressMonths" class="form-select"><option value="">Months</option></select>
                            </div>
                          </div>
                        </div>
                        <div class="mt-2">
                          <label class="label">Rent or Own?</label>
                          <div class="seg">
                            <button type="button" class="seg-btn" id="btnRent" aria-pressed="true">Rent</button>
                            <button type="button" class="seg-btn" id="btnOwn" aria-pressed="false">Own</button>
                          </div>
                          <input type="hidden" id="housingType" name="housingType" value="Rent" />
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 10. Employer -->
                <section class="form-step hidden" data-id="step-employer">
                  <div class="step-inner">
                    <div class="step-title"><h3 class="h2">10. Employment details</h3></div>
                    <div class="step-body">
                      <div class="content">
                        <div class="grid-inline-2 mt-2">
                          <input type="text" id="currentEmployer" name="currentEmployer" class="form-input" placeholder="Employer"/>
                          <input type="text" id="jobTitle" name="jobTitle" class="form-input" placeholder="Position"/>
                        </div>
                        <div class="grid-inline-2 mt-2">
                          <select id="timeWithEmployerYears" name="timeWithEmployerYears" class="form-select"><option value="">Years</option></select>
                          <select id="timeWithEmployerMonths" name="timeWithEmployerMonths" class="form-select"><option value="">Months</option></select>
                        </div>
                        <div class="mt-3">
                          <p class="label">Optional additional income</p>
                          <div class="grid-inline-2">
                            <input id="otherIncomeSource" name="otherIncomeSource" class="form-input" placeholder="Type (e.g., child benefit, side work)"/>
                            <input id="otherIncomeAmount" name="otherIncomeAmount" class="form-input" placeholder="How much per month" inputmode="numeric" maxlength="16"/>
                          </div>
                        </div>
                        <p class="muted mt-3">By selecting Next, you give Vancouver Island Credit permission to review your credit to find exact matches.</p>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- 11. hidden consent -->
                <section class="form-step hidden" data-id="step-consent">
                  <div class="step-inner"><input id="creditConsent" name="creditConsent" type="checkbox" class="hidden" checked /></div>
                </section>
              </form>
            </div>
          </div>

          <!-- FOOTER -->
          <div class="form-footer flex items-center justify-between" id="form-footer">
            <button type="button" id="btnBack" class="text-[11px] font-semibold text-zinc-600 hover:text-zinc-900 px-3 py-2 rounded">Back</button>
            <button type="button" id="btnNext" class="cta-button">Next</button>
          </div>
        </div>
      </div>

      <!-- RIGHT: Refinance Calculator (Account box removed per your request) -->
      <aside class="flex flex-col gap-4">
        <!-- Refinance Calculator -->
        <div class="card card-accent p-0" id="refi-card">
          <div class="accent-header">
            <div class="refi-title">Refinance Calculator</div>
          </div>
          <div class="refi-card">
            <div class="refi-grid mt-2">
              <div class="refi-row">
                <div>
                  <label class="label" for="refLoanInput">Loan amount</label>
                  <input id="refLoanInput" class="form-input" placeholder="$15,000" inputmode="numeric" maxlength="14" />
                </div>
                <div>
                  <label class="label" for="refTermInput">Years</label>
                  <select id="refTermInput" class="form-select">
                    <option value="">—</option>
                    <option>1</option><option>2</option><option>3</option><option>4</option>
                    <option>5</option><option>6</option><option>7</option><option>8</option>
                  </select>
                </div>
                <div>
                  <label class="label" for="refRateInput">Current %</label>
                  <input id="refRateInput" class="form-input" placeholder="8.99" inputmode="decimal" maxlength="5" />
                </div>
              </div>
              <div class="refi-mini">
                <div>
                  <label class="label" for="refNewRateSlider">Try a new rate</label>
                  <input id="refNewRateSlider" type="range" min="0.00" max="8.99" step="0.05" value="7.99" class="refi-slider">
                  <div class="text-[11px] text-zinc-700 mt-1">New rate: <b><span id="refNewRateOut">7.99</span>%</b></div>
                </div>
                <div class="refi-results" id="refResults">
                  <div class="text-zinc-500">Enter your numbers to see savings.</div>
                </div>
              </div>
              <div class="refi-note">Estimated.</div>
            </div>
          </div>
        </div>
      </aside>
    </section>

    <!-- INVENTORY -->
    <section id="inventory" class="card card-accent p-5 mt-6">
      <div class="flex items-center justify-between mb-2">
        <h3 class="h2">Browse by Vehicle Type</h3>
        <a href="#lead-form" class="text-[11px] font-semibold text-[var(--blue-600)] hover:underline js-view-inventory">
          View all <span id="inv-total" class="inv-badge text-zinc-400 font-bold">(0)</span>
        </a>
      </div>
      <p class="text-[11px] text-zinc-600 mb-1">Fill out the quick form above to see your personalized options.</p>
      <p class="text-[10px] text-zinc-500 -mt-1">Numbers refresh as you complete the short form.</p>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mt-3">
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Coupe.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Coupe <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Hatchback.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Hatchback / Wagen <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Electric.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Electric / Hybrid <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Sedan.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Sedan <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Crossover.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Crossover <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Suv.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">SUV <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Van.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Van <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
        <a href="#lead-form" class="bodytype-card js-view-inventory">
          <div class="bodytype-img" style="background-image:url('Truck.jpg');"></div>
          <div class="p-2"><p class="font-semibold text-[12px]">Truck <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div>
        </a>
      </div>
    </section>

    <!-- MAP -->
    <section id="map" class="card card-accent p-0 mt-6 overflow-hidden">
      <div class="px-4 py-3">
        <h3 class="h2">Head Office — Victoria, BC</h3>
        <p class="text-[11px] text-zinc-600 mt-1">Real location. Real people. No call centres.</p>
      </div>
      <iframe class="map-embed" title="Map — Vancouver Island Credit" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=Victoria,BC&z=11&output=embed"></iframe>
      <div class="px-4 py-3 text-[11px] text-zinc-600 border-t">525 Gorge Rd E, Victoria, BC V8T 4T2</div>
    </section>

    <footer id="contact" class="text-center text-[10px] text-zinc-500 pt-1 space-y-1">
      <p class="font-semibold text-zinc-600">Vancouver Island Credit</p>
      <p>525 Gorge Rd E, Victoria, BC V8T 4T2</p>
      <p><a href="tel:2369692424" class="hover:text-[var(--blue-600)] transition-colors">Customer service: 2369692424</a></p>
      <p class="pt-1">Serving Vancouver Island &amp; British Columbia • Delivery available province-wide</p>
      <p class="mt-1">© <span id="year"></span> Vancouver Island Credit • All rights reserved</p>
    </footer>
  </main>

  <!-- Overlay -->
  <div id="progress-overlay" class="progress-overlay hidden" aria-hidden="true">
    <div class="progress-card">
      <div class="progress-title">Working on it…</div>
      <div class="progress-track"><div id="progress-bar" class="progress-bar"></div></div>
      <ul id="progress-steps" class="progress-steps">
        <li class="active">Submitting your application…</li>
        <li>Verifying your information…</li>
        <li>Finding the best options…</li>
      </ul>
      <p class="progress-note">Secure &amp; encrypted. We never share or sell your info.</p>
    </div>
  </div>

  <script>
  const $ = (id) => document.getElementById(id);
  const bySel = (s, root=document) => root.querySelector(s);
  const bySelAll = (s, root=document) => Array.from(root.querySelectorAll(s));

  function fmtMoney(x){ x = isFinite(x) ? x : 0; return "$" + x.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
  function parseMoneyInput(v){ if (!v) return 0; return parseFloat(String(v).replace(/[^0-9.]/g,'')) || 0; }
  function formatMoneyField(input){ const num = parseMoneyInput(input.value); input.value = num ? num.toLocaleString('en-CA', {style:'currency', currency:'CAD', maximumFractionDigits:0}) : ''; }
  function calcPayment(P, annualRate, years){ const r=(annualRate/100)/12, n=years*12; if(!n||n<=0) return 0; if(r===0) return P/n; return P*r/(1-Math.pow(1+r,-n)); }

  document.addEventListener('DOMContentLoaded', function () {
    $('menuBtn')?.addEventListener('click', ()=> $('mobileMenu')?.classList.toggle('hidden'));

    // -------- FLOW MAP --------
    const stepsMap = {};
    bySelAll('.form-step').forEach(sec => stepsMap[sec.getAttribute('data-id')] = sec);

    function currentFlow(){
      const intent = $('intent')?.value || 'finance';
      const hasTrade = ($('hasTradeIn')?.value || 'No').toLowerCase()==='yes';
      if (intent==='refinance'){
        return ['step-intent','step-refi-details','step-income','step-account','step-yourinfo','step-address','step-employer','step-consent'];
      }
      let flow = ['step-intent','step-cond','step-budget','step-purchase'];
      if (hasTrade) flow.push('step-tradein');
      flow = flow.concat(['step-income','step-account','step-yourinfo','step-address','step-employer','step-consent']);
      return flow;
    }

    function showOnly(id){
      Object.values(stepsMap).forEach(sec=> sec.classList.add('hidden'));
      stepsMap[id]?.classList.remove('hidden');
    }
    function updateProgress(curId){
      const flow = currentFlow();
      const i = Math.max(0, flow.indexOf(curId));
      const visible = flow.filter(x=>x!=='step-consent');
      const total = visible.length;
      const stepNumber = Math.min(i+1, total);
      const pct = Math.round((i)/(Math.max(1,total-1))*100);

      $('btnBack').disabled = (i===0);
      $('btnNext').textContent = (i >= total-1) ? 'Submit' : 'Next';
      bySel('#progress-label').textContent = 'Step ' + stepNumber + ' of ' + total;
      bySel('#progress-fill').style.width = (total>1 ? pct : 0) + '%';
      bySel('#progress-endcap').textContent = (i >= total-1) ? 'Finding matches…' : 'Let’s get you approved';
    }

    let curStepId = 'step-intent';
    function goTo(id){ curStepId=id; showOnly(id); updateProgress(id); ensureConsistentHeights(); }

    function validateCurrent(stepId){
      const stepEl = stepsMap[stepId];
      if (!stepEl) return true;

      if (stepId==='step-intent'){
        const v = $('intent').value;
        const ok = (v==='finance' || v==='refinance');
        bySelAll('[data-intent]').forEach(x=>x.classList.toggle('err', !ok));
        return ok;
      }
      if (stepId==='step-cond'){
        const ok = !!$('vehicleCondition').value;
        bySelAll('[data-cond]').forEach(x => x.classList.toggle('err', !ok));
        return ok;
      }
      if (stepId==='step-budget'){ return !!$('budgetRange').value; }

      let ok = true;
      const fields = Array.from(stepEl.querySelectorAll('[required]'));
      fields.forEach(el=>{
        if (window.getComputedStyle(el).display==='none') return;
        let pass = (el.type==='checkbox') ? el.checked : (el.value && el.value.trim()!=='');
        if (el.id==='phone') pass = el.value.replace(/\D/g,'').length>=10;
        if (el.type==='email' || el.id==='email'){
          const v=el.value.trim();
          pass = pass && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
        }
        if (el.id==='accountPass2'){ pass = pass && ($('accountPass')?.value === $('accountPass2')?.value); bySel('#passMatchMsg')?.classList.toggle('hidden', pass); }
        el.classList.toggle('err', !pass);
        const lab = document.querySelector('label[for="'+el.id+'"]'); lab?.classList.toggle('err-label', !pass);
        if (!pass) ok=false;
      });
      return ok;
    }

    function next(delta){
      const flow = currentFlow();
      let i = flow.indexOf(curStepId);
      if (i<0) i=0;
      if (delta>0 && !validateCurrent(curStepId)) return;
      i += delta;

      const visible = flow.filter(x=>x!=='step-consent');
      const lastIdx = visible.length-1;

      if (i > lastIdx){ submitForm(); return; }
      if (i < 0) i = 0;
      goTo(visible[i]);
    }

    $('btnNext')?.addEventListener('click', ()=> next(1));
    $('btnBack')?.addEventListener('click', ()=> next(-1));

    // Intent click
    bySelAll('[data-intent]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        bySelAll('[data-intent]').forEach(x=>x.classList.remove('selected','err'));
        btn.classList.add('selected');
        $('intent').value = btn.dataset.intent;
        if (btn.dataset.intent === 'refinance'){ goTo('step-refi-details'); } else { goTo('step-cond'); }
      });
    });

    // Vehicle condition select
    bySelAll('[data-cond]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        bySelAll('[data-cond]').forEach(x=>x.classList.remove('selected','err'));
        btn.classList.add('selected');
        $('vehicleCondition').value = btn.dataset.cond || '';
        goTo('step-budget');
      });
    });

    bySelAll('[data-trade]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        bySelAll('[data-trade]').forEach(x=>x.classList.remove('selected'));
        btn.classList.add('selected');
        $('hasTradeIn').value = btn.dataset.trade || 'No';
      });
    });

    // Budget slider
    const biw = $('biWeeklyRange'); const out = $('biWeeklyOut'); const br = $('budgetRange');
    if (biw && out && br){
      const updateBudget = ()=>{ out.textContent = biw.value; br.value = '$' + biw.value + ' bi-weekly'; };
      biw.addEventListener('input', updateBudget);
      updateBudget();
    }

    // Rent/Own segmented
    function setHousing(type){
      $('housingType').value = type;
      $('btnRent')?.setAttribute('aria-pressed', String(type==='Rent'));
      $('btnOwn')?.setAttribute('aria-pressed', String(type==='Own'));
    }
    $('btnRent')?.addEventListener('click', ()=> setHousing('Rent'));
    $('btnOwn')?.addEventListener('click', ()=> setHousing('Own'));

    // Phone format
    $('phone')?.addEventListener('input', (e)=>{
      const d=e.target.value.replace(/\D/g,'').slice(0,10);
      if(d.length>6)e.target.value=`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
      else if(d.length>3)e.target.value=`(${d.slice(0,3)}) ${d.slice(3)}`;
      else if(d.length>0)e.target.value=`(${d}`;
    });

    // Submit
    function generateAppCode(){ const n=Math.floor(Math.random()*1_000_000); return 'ABC-' + String(n).padStart(6,'0'); }
    async function runProgressOverlay(minMs=4200){
      const overlay = $('progress-overlay'); const bar = $('progress-bar'); const stepsEl = bySelAll('#progress-steps li');
      if (!overlay || !bar) return;
      overlay.classList.remove('hidden');
      const stages = [{width:35,index:0,ms:900},{width:70,index:1,ms:1200},{width:100,index:2,ms:1400}];
      const t0=Date.now();
      for (const st of stages){
        stepsEl.forEach((li,i)=> li.classList.toggle('active', i===st.index));
        requestAnimationFrame(()=> bar.style.width = st.width + '%');
        await new Promise(r=>setTimeout(r, st.ms));
      }
      const elapsed=Date.now()-t0; if (elapsed<minMs) await new Promise(r=>setTimeout(r, minMs-elapsed));
      overlay.classList.add('hidden');
    }
    function submitForm(){
      const flow = currentFlow().filter(id=>id!=='step-consent');
      for (const id of flow){ if(!validateCurrent(id)){ goTo(id); return; } }
      bySel('#the-form').requestSubmit();
    }
    bySel('#the-form')?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const code = generateAppCode();
      try { sessionStorage.setItem('vic_app_code', code); } catch(_){}
      const codeInput = $('appCode'); if (codeInput) codeInput.value = code;
      await runProgressOverlay(4200);
      e.target.submit();
    });

    // Inventory “View all”
    bySelAll('.js-view-inventory').forEach(el=>{
      el.addEventListener('click', (e)=>{
        e.preventDefault();
        $('lead-form')?.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    // Header login demo
    $('header-login-form')?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const u = $('hdrUser')?.value?.trim();
      const p = $('hdrPass')?.value?.trim();
      if (!u || !p) return;
      alert('Logged in (demo).');
    });

    // DOB helpers
    function populateDOBYears(sel){ if(!sel) return; const start=2004; sel.innerHTML = ''; for(let y=start; y>=1940; y--){ const o=document.createElement('option'); o.value=y; o.textContent=y; sel.appendChild(o); } }
    function populateMonths(sel){
      if(!sel) return;
      const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
      sel.innerHTML = '<option value="">MM</option>';
      months.forEach((name, i)=>{
        const num = String(i+1).padStart(2,'0');
        const o = document.createElement('option');
        o.value = (i+1); o.dataset.num = num; o.dataset.long = name + ' ' + num; o.textContent = num;
        sel.appendChild(o);
      });
      function setLabelsLong(){ Array.from(sel.options).forEach(opt=>{ if(opt.value && opt.dataset.long) opt.textContent = opt.dataset.long; }); }
      function setLabelsShort(){ Array.from(sel.options).forEach(opt=>{ if(opt.value && opt.dataset.num) opt.textContent = opt.dataset.num; }); }
      sel.addEventListener('mousedown', setLabelsLong);
      sel.addEventListener('touchstart', setLabelsLong, {passive:true});
      sel.addEventListener('focus', setLabelsLong);
      sel.addEventListener('change', setLabelsShort);
      sel.addEventListener('blur', setLabelsShort);
    }
    function updateDays(){
      const y=parseInt($('dobYear')?.value||'',10);
      const m=parseInt($('dobMonth')?.value||'',10);
      const selV=parseInt($('dobDay')?.value||'',10);
      const days=(y&&m)?new Date(y,m,0).getDate():31;
      const daySel=$('dobDay'); if(!daySel) return;
      daySel.innerHTML='<option value="">DD</option>';
      for(let i=1;i<=days;i++){ const o=document.createElement('option'); o.value=i; o.textContent=(i<10?('0'+i):String(i)); daySel.appendChild(o); }
      if(selV&&selV<=days) daySel.value=selV;
    }
    function populateDropdown(sel,start,end,label,singular){ if(!sel) return; sel.innerHTML='<option value="">'+(singular||label)+'</option>'; for(let i=start;i<=end;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; sel.appendChild(o); } }
    function populateProvinces(sel){ if(!sel) return; const prov=["AB","BC","MB","NB","NL","NS","NT","NU","ON","PE","QC","SK","YT"]; sel.innerHTML='<option value="">Prov</option>'; prov.forEach(p=>{ const o=document.createElement('option'); o.value=p; o.textContent=p; sel.appendChild(o); }); }
    function populateYears(sel, start, end){ if(!sel) return; sel.innerHTML='<option value="">Year</option>'; for(let y=start; y>=end; y--){ const o=document.createElement('option'); o.value=y; o.textContent=y; sel.appendChild(o);} }

    // ---- Refinance Calculator ----
    function setupRefiCalcInputs(){
      const loanEl = $('refLoanInput');
      const rateEl = $('refRateInput');
      const termEl = $('refTermInput');
      const newRateSlider = $('refNewRateSlider');
      const newRateOut = $('refNewRateOut');
      const results = $('refResults');

      if (!(loanEl && rateEl && termEl && newRateSlider && newRateOut)) return;

      loanEl.addEventListener('blur', ()=>{ formatMoneyField(loanEl); update(); });
      [loanEl, rateEl, termEl].forEach(el=> el.addEventListener('input', update));
      newRateSlider.addEventListener('input', ()=>{ newRateOut.textContent = Number(newRateSlider.value).toFixed(2); update(); });

      function update(){
        const loan = parseMoneyInput(loanEl.value);
        const rate = parseFloat(rateEl.value)||0;
        const years = parseFloat(termEl.value)||0;

        if (!loan || !rate || !years){
          results.innerHTML = "<div class='text-zinc-500'>Enter your numbers to see savings.</div>";
          return;
        }

        // cap at 8.99 and keep <= (current rate - 0.99)
        const desired = Math.min(8.99, Math.max(0, parseFloat(newRateSlider.value)||0));
        const maxAllowed = Math.max(0, rate - 0.99);
        const newRate = Math.min(desired, maxAllowed);
        if (newRate !== desired){ newRateSlider.value = newRate.toFixed(2); }
        newRateOut.textContent = newRate.toFixed(2);

        const curPmt = calcPayment(loan, rate, years);
        const curTotInt = curPmt*years*12 - loan;

        // $3,000 silently added to new loan
        const newLoan = loan + 3000;
        const newPmt = calcPayment(newLoan, newRate, years);
        const newTotInt = newPmt*years*12 - newLoan;

        const interestSaved = Math.max(0, curTotInt - newTotInt);

        results.innerHTML =
          `<div><span class="text-zinc-500">New payment:</span> ${fmtMoney(newPmt)}</div>
           <div><span class="text-zinc-500">Total interest saved:</span> ${fmtMoney(interestSaved)}</div>`;
      }

      newRateOut.textContent = Number(newRateSlider.value).toFixed(2);
      update();
    }

    // ---------- CONSISTENT HEIGHTS ----------
    function ensureConsistentHeights(){
      const viewport = $('step-viewport');
      const footer = $('form-footer');
      if (!viewport || !footer) return;

      const footerH = footer.offsetHeight || 0;
      const extra = 6; // smaller breathing space above footer content
      bySelAll('.step-inner').forEach(inner=>{
        inner.style.setProperty('--footer-space', (footerH + extra) + 'px');
      });

      let maxContent = 0;
      const hidden = [];
      bySelAll('.form-step').forEach(sec=>{
        if (sec.classList.contains('hidden')){ hidden.push(sec); sec.classList.remove('hidden'); }
      });
      bySelAll('.form-step .step-body > .content').forEach(c=>{
        maxContent = Math.max(maxContent, c.offsetHeight);
      });
      hidden.forEach(sec=> sec.classList.add('hidden'));

      bySelAll('.form-step .step-body').forEach(b=>{
        b.style.setProperty('--content-min', maxContent + 'px');
      });
    }

    // ===== init =====
    (function init(){
      bySel('#year').textContent = new Date().getFullYear();

      $('intent').value = 'finance';
      $('vehicleCondition') && ( $('vehicleCondition').value = 'Both' );
      bySel('[data-cond="Both"]')?.classList.add('selected');
      $('housingType') && ( $('housingType').value = 'Rent' );

      // DOB
      populateDOBYears($('dobYear'));
      populateMonths($('dobMonth'));
      updateDays();
      $('dobMonth')?.addEventListener('change', updateDays);
      $('dobYear')?.addEventListener('change', updateDays);

      // Tenures & address helpers
      populateDropdown($('timeWithEmployerYears'),0,30,'Years','Year');
      populateDropdown($('timeWithEmployerMonths'),0,11,'Months','Month');
      populateDropdown($('timeAtAddressYears'),0,30,'Years','Year');
      populateDropdown($('timeAtAddressMonths'),0,11,'Months','Month');
      populateProvinces($('currentProvince'));

      // Years for trade/refi vehicle
      populateYears($('tradeInYear'), new Date().getFullYear(), 1995);
      populateYears($('refiYear'),   new Date().getFullYear(), 1995);

      // Start
      goTo('step-intent');

      // Refi calc
      setupRefiCalcInputs();

      // Keep heights locked to tallest step
      ensureConsistentHeights();
      window.addEventListener('resize', ensureConsistentHeights);

      $('btnNext')?.addEventListener('click', ()=> setTimeout(ensureConsistentHeights, 0));
      $('btnBack')?.addEventListener('click', ()=> setTimeout(ensureConsistentHeights, 0));
    })();
  });
  </script>
</body>
</html>
