<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Vancouver Island Credit | Auto Approvals Online — Work with Blake</title>

  <meta name="description" content="Fast, confidential auto approvals across Vancouver Island & BC. New & used options. Delivery to your door. Work 1 on 1 with Blake Stolth — no call centres." />
  <link rel="canonical" href="https://vancouverislandcredit.ca/"/>
  <meta property="og:title" content="Vancouver Island Credit — Auto Approvals Online"/>
  <meta property="og:description" content="Get approved online. New & used inventory across Vancouver Island & BC. Delivery to your door. Work directly with Blake."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://vancouverislandcredit.ca/"/>
  <meta property="og:image" content="https://vancouverislandcredit.ca/0041B99D-D49A-4024-AA7A-2786A4605342.jpg"/>
  <meta name="theme-color" content="#2A5D9F"/>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --blue-600:#2A5D9F; --blue-700:#214B80; --blue-100:#EAF1FB; --blue-grad:#4C7CC0;

      --fs-h1: 22px;
      --fs-h2: 18px;
      --fs-body: 14px;
      --fs-label: 12px;
      --fs-cta: 14px;

      --pad-y: 10px;
      --gap-regular: 8px;

      --input-py: 6px;
      --input-px: 10px;
      --radius: 10px;

      --nav-font: 15px;
    }
    @media (max-width:640px){
      :root{ --nav-font: 14px; }
    }

    body{ font-family:'Inter',sans-serif; background:#f6f7fb; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .card{ background:#fff; border-radius:12px; border:1px solid #e5e7eb; box-shadow:0 8px 18px -10px rgb(0 0 0 / .15); }

    .h1{ font-size:var(--fs-h1); font-weight:800; color:#0f172a; }
    .h2{ font-size:var(--fs-h2); font-weight:800; color:#0f172a; }

    .form-input,.form-select,.form-textarea{
      background:#f3f4f6; color:#18181b; border:1.5px solid #e5e7eb; font-size:var(--fs-body); width:100%;
      padding:var(--input-py) var(--input-px); border-radius:var(--radius); transition:all .15s ease;
    }
    .form-input::placeholder{ color:#a1a1aa; }
    .form-input:focus,.form-select:focus,.form-textarea:focus{ background:#fff; border-color:var(--blue-600); box-shadow:0 0 0 3px rgba(42,93,159,.15); outline:none; }
    .label{ font-size:var(--fs-label); color:#3f3f46; font-weight:600; }

    .cta-button{ background:var(--blue-600); color:#fff; font-weight:800; padding:.5rem .8rem; border-radius:.6rem; font-size:var(--fs-cta); }
    .cta-button:hover{ background:var(--blue-700); }

    .tile,.choice{ border-radius:10px; border:1.5px solid #e5e7eb; background:#fff; transition:.15s; font-weight:800; color:#111827; font-size:13px; }
    .tile{ display:flex; align-items:center; justify-content:center; text-align:center; aspect-ratio:4/3; width:100%; padding:.35rem; }
    .choice{ padding:.5rem; text-align:center; width:100%; }
    .tile:hover,.choice:hover{ border-color:var(--blue-600); background:#f5f8ff; }
    .tile.selected,.choice.selected{ border-color:var(--blue-600); background:#eef4ff; box-shadow:inset 0 0 0 2px var(--blue-600); }

    .track{ height:6px; background:#e5e7eb; border-radius:9999px; overflow:hidden; }
    .fill{ height:6px; background:linear-gradient(90deg,var(--blue-600),var(--blue-grad)); border-radius:9999px; width:0%; transition:width .25s ease; }

    .err{ border-color:#ef4444 !important; } .err-label{ color:#ef4444 !important; }

    .seg{ display:inline-flex; gap:4px; background:#f3f4f6; padding:3px; border-radius:8px; }
    .seg-btn{ padding:6px 8px; border-radius:6px; font-weight:600; color:#374151; background:transparent; border:2px solid transparent; font-size:12px; }
    .seg-btn[aria-pressed="true"]{ background:#e0ecff; color:#214B80; border-color:#bfdbfe; }

    /* Form shell */
    .form-shell{ position:relative; height:auto; overflow:hidden; }
    .form-shell .sticky{ position:sticky; top:0; z-index:10; background:#fff; }

    .step-inner{ width:100%; padding-top:var(--pad-y); padding-bottom:var(--pad-y); }
    .step-inner > .h2{ margin-top:0; margin-bottom:var(--pad-y); }

    .step-viewport{ overflow:auto; }

    .vstack > * + *{ margin-top: var(--gap-regular); }

    .bodytype-card{ overflow:hidden; border-radius:10px; border:1px solid #e5e7eb; background:#fff; transition:transform .15s,box-shadow .15s,border-color .15s; }
    .bodytype-card:hover{ transform:translateY(-1px); border-color:var(--blue-600); box-shadow:0 10px 18px -12px rgba(42,93,159,.28); }
    .bodytype-img{ background:#e5e7eb center/cover no-repeat; height:92px; }
    @media (min-width:640px){ .bodytype-img{ height:110px; } }

    .grid-sq{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
    .grid-2{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; }
    .grid-3{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; }
    @media (min-width:640px){ .grid-sq{ grid-template-columns:repeat(4,minmax(0,1fr)); } }

    /* Smart field sizing */
    .grid-name3{ display:grid; gap:10px; grid-template-columns: 1.8fr 2.4fr 1.8fr; }
    .grid-trade5{ display:grid; gap:10px; grid-template-columns: .9fr 1.6fr 1.6fr 1.1fr 1.6fr; }
    .grid-addr5{ display:grid; gap:10px; grid-template-columns: 3.2fr .8fr 1.6fr .8fr 1.0fr; }
    .grid-housing3{ display:grid; gap:10px; grid-template-columns: 1.2fr 1fr 1.2fr; }

    /* Income */
    .grid-income3{ display:grid; gap:8px; grid-template-columns: 1.2fr 1.8fr 1.5fr; }
    .grid-income2{ display:grid; gap:8px; grid-template-columns: 1.1fr 1.4fr; }
    .tenure-2{ display:grid; gap:8px; grid-template-columns: 1fr 1fr; }

    .abc-badge{
      display:inline-flex; align-items:center; justify-content:center;
      width:20px; height:20px; border-radius:9999px;
      border:2px solid #2A5D9F; color:#2A5D9F; background:#fff;
      font-weight:800; font-size:11px; line-height:1;
      flex-shrink:0;
    }

    section, header, footer { scroll-margin-top: 70px; }
    #lead-form .form-input, #lead-form .form-select, #lead-form .form-textarea{ padding:5px 10px; }
    .form-footer{ padding: var(--pad-y) 1rem; }
    #lead-form .step-viewport, #lead-form .form-footer { max-width: 760px; margin-left:auto; margin-right:auto; }

    .form-step[data-step="1"] .tile,
    .form-step[data-step="2"] .tile,
    .form-step[data-step="3"] .tile{ aspect-ratio: 1 / 1; font-size: 15px; }
    .form-step[data-step="1"] .grid-sq,
    .form-step[data-step="3"] .grid-sq{ gap:12px; }
    .form-step[data-step="2"] .grid-3{ gap:12px; max-width:560px; margin:0 auto; }
    @media (min-width:640px){
      .form-step[data-step="1"] .grid-sq,
      .form-step[data-step="3"] .grid-sq{ grid-template-columns: repeat(4, minmax(0,1fr)); }
      .form-step[data-step="2"] .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    @media (max-width:639px){
      .form-step[data-step="1"] .grid-sq,
      .form-step[data-step="3"] .grid-sq{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      .form-step[data-step="2"] .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    .powered-card{
      background: linear-gradient(180deg, #ffffff 0%, #f6f8fc 100%);
      border:1px solid #e5e7eb; border-radius:12px;
      box-shadow:0 8px 18px -12px rgba(0,0,0,.12);
    }
    .equifax-logo{ max-width:100%; max-height:110px; height:auto; object-fit:contain; }

    .bodytype-card.loading .bodytype-img{ position:relative; overflow:hidden; }
    .bodytype-card.loading .bodytype-img::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(240,243,248,.55) 45%, rgba(255,255,255,0) 100%);
      transform: translateX(-100%); animation: Shimmer .9s ease-in-out 1;
    }
    @keyframes Shimmer { to { transform: translateX(100%); } }

    .inv-badge{ transition: opacity .15s ease, transform .15s ease; opacity:.65; }
    @media (max-width: 767px){ .powered-card{ padding: 10px; } .equifax-logo{ max-height:44px; } }

    .map-embed{ width:100%; height:150px; border:0; }
    @media (min-width:768px){ .map-embed{ height:200px; } }

    /* ===== Progress overlay ===== */
    .progress-overlay{position:fixed;inset:0;background:rgba(15,23,42,.55);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:50}
    .progress-card{background:#fff;border-radius:12px;box-shadow:0 20px 40px -20px rgba(0,0,0,.35);width:min(520px,92vw);padding:18px 16px}
    .progress-title{font-weight:800;font-size:16px;color:#0f172a}
    .progress-track{height:8px;background:#e5e7eb;border-radius:9999px;overflow:hidden;margin-top:10px}
    .progress-bar{height:8px;width:0%;background:linear-gradient(90deg,var(--blue-600),var(--blue-grad));transition:width .6s ease}
    .progress-steps{list-style:none;padding:0;margin:12px 0 0;font-size:13px;color:#374151}
    .progress-steps li{display:flex;align-items:center;gap:8px;opacity:.7}
    .progress-steps li.active{opacity:1;font-weight:700}
    .progress-note{margin-top:10px;font-size:12px;color:#64748b}
    .hidden{display:none}

    /* ===== Brand area ===== */
    .brand-left{ display:flex; align-items:center; gap:12px; }
    .site-logo{ height:64px; width:auto; object-fit:contain; display:block; transform:translateY(-2px); }
    @media (max-width:640px){ .site-logo{ height:58px; transform:translateY(-1px); } }
    .brand-title{ color:#0f172a; font-weight:800; letter-spacing:-0.01em; font-size:var(--nav-font); white-space:nowrap; text-decoration:none; }

    .nav-link{ font-size:var(--nav-font); font-weight:700; }
    .nav-cta{ font-size:var(--nav-font); font-weight:800; padding-top:.4rem; padding-bottom:.4rem; }

    /* ===== Drawers / Offer UI ===== */
    .backdrop{position:fixed;inset:0;background:rgba(15,23,42,.55);backdrop-filter:blur(2px);display:none;z-index:70}
    .sheet{position:fixed;inset:0 auto 0 0;background:#fff;max-width:980px;width:100%;transform:translateX(-102%);transition:transform .22s ease;z-index:80;box-shadow:0 10px 30px -12px rgba(0,0,0,.35);border-right:1px solid #e5e7eb}
    .sheet.right{left:auto;right:0;transform:translateX(102%)}
    .sheet.open{transform:translateX(0)}
    .backdrop.open{display:block}

    .option-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media(min-width:640px){.option-grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .opt-tile{border:1.5px solid #e5e7eb;border-radius:12px;background:#fff;padding:12px;display:flex;flex-direction:column;gap:8px;cursor:pointer;transition:.15s}
    .opt-tile:hover{border-color:var(--blue-600);background:#f5f8ff}
    .opt-h{font-weight:800;font-size:13px;color:#0f172a}
    .opt-sub{font-size:12px;color:#475569}
    .opt-pill{font-size:10px;font-weight:800;color:#214B80;background:#e6f0ff;padding:2px 6px;border-radius:9999px;align-self:flex-start}

    .offer-wrap{display:grid;grid-template-columns:1.1fr .9fr;gap:14px;height:100%}
    @media(max-width:768px){.offer-wrap{grid-template-columns:1fr;gap:10px}}
    .offer-left{border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff}
    .offer-right{border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:12px}

    .gallery{position:relative}
    .gallery-main{aspect-ratio:4/3;background:#e5e7eb center/cover no-repeat;cursor:zoom-in}
    .gallery-strip{display:flex;gap:8px;padding:8px;overflow:auto;border-top:1px solid #e5e7eb}
    .gallery-thumb{width:72px;height:56px;border-radius:8px;background:#e5e7eb center/cover no-repeat;border:2px solid transparent;flex:0 0 auto;cursor:pointer}
    .gallery-thumb.active{border-color:var(--blue-600)}

    .offer-tabs{display:inline-flex;gap:6px;background:#f3f4f6;padding:4px;border-radius:10px}
    .offer-tab{padding:6px 10px;border-radius:8px;border:2px solid transparent;font-weight:800;font-size:12px;color:#374151;background:transparent;cursor:pointer}
    .offer-tab[aria-pressed="true"]{background:#e0ecff;color:#214B80;border-color:#bfdbfe}
    .offer-field{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border:1px solid #eef2f7;border-radius:10px;background:#fff}
    .offer-field + .offer-field{margin-top:8px}
    .offer-key{font-size:12px;color:#475569;font-weight:700}
    .offer-val{font-size:14px;font-weight:800;color:#0f172a}

    .zoom-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:90}
    .zoom-img{max-width:92vw;max-height:92vh;border-radius:12px;box-shadow:0 20px 50px rgba(0,0,0,.5)}
  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"AutoDealer",
    "name":"Vancouver Island Credit",
    "telephone":"+1-236-969-2424",
    "address":{"@type":"PostalAddress","streetAddress":"525 Gorge Rd E","addressLocality":"Victoria","addressRegion":"BC","postalCode":"V8T 4T2","addressCountry":"CA"},
    "areaServed":"British Columbia, Canada",
    "image":"https://vancouverislandcredit.ca/0041B99D-D49A-4024-AA7A-2786A4605342.jpg",
    "url":"https://vancouverislandcredit.ca",
    "slogan":"Get approved online. Delivery across BC. Work directly with Blake.",
    "founder":{"@type":"Person","name":"Blake Stolth"},
    "makesOffer":[{"@type":"Offer","itemOffered":{"@type":"Service","name":"Auto Financing (New & Used)"}}]
  }
  </script>
</head>
<body>
  <!-- NAV -->
  <header class="w-full max-w-5xl mx-auto mt-4 px-4">
    <nav class="bg-white/90 backdrop-blur card px-4 sm:px-6 py-2.5 flex items-center justify-between">
      <div class="brand-left">
        <img src="Logo.png" alt="Vancouver Island Credit logo" class="site-logo"/>
        <a href="#" class="brand-title" aria-label="Vancouver Island Credit — Home">Vancouver Island Credit</a>
      </div>
      <div class="hidden sm:flex items-center gap-6 font-semibold text-zinc-700">
        <a href="#inventory" class="nav-link hover:text-[var(--blue-600)]">Inventory</a>
        <a href="#about" class="nav-link hover:text-[var(--blue-600)]">About</a>
        <a href="#contact" class="nav-link hover:text-[var(--blue-600)]">Contact</a>
        <a href="#lead-form" class="cta-button nav-cta !py-1.5">Apply Now</a>
      </div>
      <button id="menuBtn" class="sm:hidden inline-flex items-center justify-center h-9 w-9 rounded-md border border-zinc-200" aria-label="Open menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-zinc-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </nav>
    <div id="mobileMenu" class="hidden sm:hidden mt-2 card px-4 py-3">
      <div class="flex flex-col gap-2 font-semibold text-zinc-700">
        <a href="#inventory" class="py-2 px-2 rounded hover:bg-[var(--blue-100)]">Inventory</a>
        <a href="#about" class="py-2 px-2 rounded hover:bg-[var(--blue-100)]">About</a>
        <a href="#contact" class="py-2 px-2 rounded hover:bg-[var(--blue-100)]">Contact</a>
        <a href="#lead-form" class="mt-1 cta-button text-center">Apply Now</a>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="w-full max-w-5xl mx-auto px-4 py-6 space-y-6">
    <!-- HERO / ABOUT -->
    <section id="about" class="card p-5">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="vstack">
          <h1 class="h1">Get driving in 3 easy steps</h1>
          <ol class="text-[13px] text-zinc-700 space-y-2">
            <li class="flex items-start gap-2">
              <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[var(--blue-600)] text-white font-extrabold text-[12px]">1</span>
              <span><b>Enter your info</b> — 2–3 minutes, no pressure.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[var(--blue-600)] text-white font-extrabold text-[12px]">2</span>
              <span><b>See options you qualify for</b> across BC.</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[var(--blue-600)] text-white font-extrabold text-[12px]">3</span>
              <span><b>We deliver</b> to your door — fast & stress-free.</span>
            </li>
          </ol>
        </div>
        <div class="vstack">
          <h2 class="h2">Why people pick us</h2>
          <ul class="text-[13px] text-zinc-700 space-y-2">
            <li class="flex items-start gap-2"><span class="abc-badge">A</span><span><b>All credit welcome:</b> high approval rates.</span></li>
            <li class="flex items-start gap-2"><span class="abc-badge">B</span><span><b>Bigger selection:</b> new &amp; used vehicles across BC.</span></li>
            <li class="flex items-start gap-2"><span class="abc-badge">C</span><span><b>Contact from us:</b> no information sold to dealerships.</span></li>
            <li class="flex items-start gap-2"><span class="abc-badge">D</span><span><b>Delivery across BC:</b> right to your doorstep.</span></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- FORM + SIDEBAR -->
    <section class="grid md:grid-cols-4 gap-4">
      <!-- FORM -->
      <div class="md:col-span-3 card p-0 overflow-hidden" id="lead-form">
        <div class="form-shell" id="form-shell">
          <!-- progress -->
          <div class="sticky px-4 py-2 border-b">
            <div class="flex items-center justify-between">
              <div id="progress-label" class="text-[11px] font-semibold text-zinc-700">Step 1</div>
              <div id="progress-endcap" class="text-[11px] text-[var(--blue-700)] font-semibold">Let’s get you approved</div>
            </div>
            <div class="track mt-2"><div id="progress-fill" class="fill"></div></div>
          </div>

          <!-- STEP VIEWPORT -->
          <div id="step-viewport" class="step-viewport px-4">
            <form id="the-form" name="lead-form" method="POST" data-netlify="true" data-netlify-honeypot="bot-field" action="/thank-you.html" novalidate>
              <input type="hidden" name="form-name" value="lead-form"/>
              <input type="hidden" name="app_type" id="app_type" value="Full Application" />
              <input type="hidden" name="vehicleCondition" id="vehicleCondition" />
              <input type="hidden" name="vehicleType" id="vehicleType" />
              <p class="hidden" aria-hidden="true"><label>Don’t fill this out: <input name="bot-field"/></label></p>

              <!-- 1: Vehicle Type -->
              <section class="form-step" data-step="1">
                <div class="step-inner">
                  <h3 class="h2">What body style?</h3>
                  <div class="grid-sq mt-2">
                    <button type="button" class="tile" data-type="Car">Car</button>
                    <button type="button" class="tile" data-type="SUV">SUV</button>
                    <button type="button" class="tile" data-type="Van">Van</button>
                    <button type="button" class="tile" data-type="Truck">Truck</button>
                  </div>
                </div>
              </section>

              <!-- 2: Condition -->
              <section class="form-step hidden" data-step="2">
                <div class="step-inner">
                  <h3 class="h2">Used or new?</h3>
                  <div class="grid-3 mt-2">
                    <button type="button" class="tile" data-cond="Used">Used</button>
                    <button type="button" class="tile" data-cond="New">New</button>
                    <button type="button" class="tile" data-cond="Both">Both</button>
                  </div>
                </div>
              </section>

              <!-- 3: Budget -->
              <section class="form-step hidden" data-step="3">
                <div class="step-inner">
                  <h3 class="h2">What’s your monthly budget?</h3>
                  <div class="grid-sq mt-2">
                    <label class="tile cursor-pointer"><input type="radio" class="sr-only" name="budgetRange" value="$250 – $375" required><span>$250–$375</span></label>
                    <label class="tile cursor-pointer"><input type="radio" class="sr-only" name="budgetRange" value="$376 – $499" required><span>$376–$499</span></label>
                    <label class="tile cursor-pointer"><input type="radio" class="sr-only" name="budgetRange" value="$500 – $750" required><span>$500–$750</span></label>
                    <label class="tile cursor-pointer"><input type="radio" class="sr-only" name="budgetRange" value="$750+" required><span>$750+</span></label>
                  </div>
                </div>
              </section>

              <!-- 4: Purchase -->
              <section class="form-step hidden" data-step="4" id="step-purchase">
                <div class="step-inner">
                  <h3 class="h2">Purchase details</h3>
                  <div class="grid grid-cols-2 gap-2 mt-2">
                    <div>
                      <label for="downPayment" class="label mb-1 block">Down payment?</label>
                      <select id="downPayment" name="downPayment" class="form-select">
                        <option value="">Select…</option>
                        <option>$3,000+</option>
                        <option>$1,000–$3,000</option>
                        <option>$0–$1,000</option>
                      </select>
                    </div>
                    <div>
                      <label for="hasTradeIn" class="label mb-1 block">Trade-in?</label>
                      <select id="hasTradeIn" name="hasTradeIn" class="form-select">
                        <option>No</option>
                        <option>Yes</option>
                      </select>
                    </div>
                  </div>

                  <div id="tradeInDetails" class="hidden mt-2">
                    <div class="grid-trade5">
                      <input type="number" name="tradeInYear" placeholder="Year" class="form-input" inputmode="numeric" min="2000" max="2025"/>
                      <input type="text" name="tradeInMake" placeholder="Make" class="form-input" maxlength="40"/>
                      <input type="text" name="tradeInModel" placeholder="Model" class="form-input" maxlength="50"/>
                      <input type="number" name="tradeInKms" placeholder="KM" class="form-input" inputmode="numeric" min="0" max="1000000"/>
                      <input type="text" name="tradeInOwed" placeholder="Money owed e.g. $5,000 or None" class="form-input" maxlength="20"/>
                    </div>
                  </div>
                </div>
              </section>

              <!-- 5: Your information -->
              <section class="form-step hidden" data-step="5" id="step-yourinfo">
                <div class="step-inner">
                  <h3 class="h2">Your information</h3>

                  <div class="grid-name3">
                    <div>
                      <label for="firstName" class="label mb-1 block">First name <span class="text-red-500">*</span></label>
                      <input type="text" id="firstName" name="firstName" class="form-input" autocomplete="given-name" maxlength="50" required/>
                    </div>
                    <div>
                      <label for="middleName" class="label mb-1 block">Middle Name(s) <span class="text-red-500">*</span></label>
                      <input type="text" id="middleName" name="middleName" class="form-input" autocomplete="additional-name" maxlength="100" required/>
                    </div>
                    <div>
                      <label for="lastName" class="label mb-1 block">Last name <span class="text-red-500">*</span></label>
                      <input type="text" id="lastName" name="lastName" class="form-input" autocomplete="family-name" maxlength="50" required/>
                    </div>
                  </div>

                  <div class="grid grid-cols-2 gap-2 mt-2">
                    <div>
                      <label for="phone" class="label mb-1 block">Phone <span class="text-red-500">*</span></label>
                      <input type="tel" id="phone" name="phone" class="form-input" autocomplete="tel" inputmode="tel" maxlength="14" required/>
                    </div>
                    <div>
                      <label for="email" class="label mb-1 block">Email <span class="text-red-500">*</span></label>
                      <input type="email" id="email" name="email" class="form-input" autocomplete="email" maxlength="100" required/>
                    </div>
                  </div>

                  <div class="grid grid-cols-4 gap-2 mt-2">
                    <div>
                      <label class="label mb-1 block">Month <span class="text-red-500">*</span></label>
                      <select id="dobMonth" name="dobMonth" class="form-select" required><option value="">MM</option></select>
                    </div>
                    <div>
                      <label class="label mb-1 block">Day <span class="text-red-500">*</span></label>
                      <select id="dobDay" name="dobDay" class="form-select" required><option value="">DD</option></select>
                    </div>
                    <div>
                      <label class="label mb-1 block">Year <span class="text-red-500">*</span></label>
                      <input type="number" id="dobYear" name="dobYear" placeholder="YYYY" class="form-input" inputmode="numeric" min="1900" max="2099" required/>
                    </div>
                    <div id="marital-wrap">
                      <label for="maritalStatus" class="label mb-1 block">Marital <span class="text-red-500">*</span></label>
                      <select id="maritalStatus" name="maritalStatus" class="form-select" required>
                        <option value="">Select</option>
                        <option>Single</option><option>Married</option><option>Common-Law</option>
                        <option>Divorced</option><option>Separated</option><option>Widowed</option>
                      </select>
                    </div>
                  </div>
                </div>
              </section>

              <!-- 6: Income -->
              <section class="form-step hidden" data-step="6" id="step-income">
                <div class="step-inner">
                  <h3 class="h2">Income</h3>

                  <div class="grid-income3">
                    <div>
                      <label for="incomeSourceFull" class="label mb-1 block">Primary income <span class="text-red-500">*</span></label>
                      <select id="incomeSourceFull" name="incomeSourceFull" class="form-select" required>
                        <option value="">Select…</option>
                        <option value="Full-Time">Full-Time</option>
                        <option value="Part-Time">Part-Time</option>
                        <option value="Self-Employed">Self-Employed</option>
                        <option value="Disability">Disability</option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                    <div id="empWrap">
                      <label for="currentEmployer" class="label mb-1 block">Employer <span class="text-red-500">*</span></label>
                      <input type="text" id="currentEmployer" name="currentEmployer" class="form-input" placeholder="Company" maxlength="80"/>
                    </div>
                    <div id="posWrap">
                      <label for="jobTitle" class="label mb-1 block">Position <span class="text-red-500">*</span></label>
                      <input type="text" id="jobTitle" name="jobTitle" class="form-input" placeholder="Role" maxlength="60"/>
                    </div>
                  </div>

                  <div class="grid-income2 mt-1">
                    <div id="monthlyWrap">
                      <label for="avgMonthlyIncome" class="label mb-1 block">Monthly income (before tax) <span class="text-red-500">*</span></label>
                      <input type="text" id="avgMonthlyIncome" name="avgMonthlyIncome" class="form-input" placeholder="$4,000" inputmode="numeric" maxlength="16"/>
                    </div>
                    <div id="tenureWrap">
                      <label class="label mb-1 block">Time with employer <span class="text-zinc-500">(Years &amp; Months)</span> <span class="text-red-500">*</span></label>
                      <div class="tenure-2">
                        <select id="timeWithEmployerYears" name="timeWithEmployerYears" class="form-select"><option value="">Years</option></select>
                        <select id="timeWithEmployerMonths" name="timeWithEmployerMonths" class="form-select"><option value="">Months</option></select>
                      </div>
                    </div>
                  </div>

                  <div id="full-self" class="hidden grid grid-cols-2 gap-2 mt-1">
                    <div>
                      <label for="businessName" class="label mb-1 block">Business <span class="text-red-500">*</span></label>
                      <input type="text" id="businessName" name="businessName" class="form-input" placeholder="Name" maxlength="100"/>
                    </div>
                    <div>
                      <label for="selfMonthlyIncome" class="label mb-1 block">Avg monthly (pre-tax) <span class="text-red-500">*</span></label>
                      <input type="text" id="selfMonthlyIncome" name="selfMonthlyIncome" class="form-input" placeholder="$4,000" inputmode="numeric" maxlength="16"/>
                    </div>
                  </div>

                  <div id="full-other" class="hidden grid grid-cols-2 gap-2 mt-1">
                    <div>
                      <label for="otherIncomeAmount" class="label mb-1 block">Monthly (pre-tax) <span class="text-red-500">*</span></label>
                      <input type="text" id="otherIncomeAmount" name="otherIncomeAmount" class="form-input" placeholder="$2,000" inputmode="numeric" maxlength="16"/>
                    </div>
                    <div>
                      <label for="otherIncomeSource" class="label mb-1 block">Source <span class="text-red-500">*</span></label>
                      <input id="otherIncomeSource" name="otherIncomeSource" class="form-input" placeholder="Describe" maxlength="80"/>
                    </div>
                  </div>
                </div>
              </section>

              <!-- 7: Address -->
              <section class="form-step hidden" data-step="7" id="step-address">
                <div class="step-inner">
                  <h3 class="h2">Where do you live?</h3>

                  <div id="addr-full-current">
                    <div class="grid-addr5 mt-2">
                      <input type="text" id="currentStreetAddress" name="currentStreetAddress" class="form-input" placeholder="Street Address" autocomplete="street-address" maxlength="120" required/>
                      <input type="text" id="currentUnit" name="currentUnit" class="form-input" placeholder="Unit #" maxlength="10"/>
                      <input type="text" id="currentCity" name="currentCity" class="form-input" placeholder="City" autocomplete="address-level2" maxlength="60" required/>
                      <select id="currentProvince" name="currentProvince" class="form-select" required><option value="">Prov</option></select>
                      <input type="text" id="currentPostalCode" name="currentPostalCode" class="form-input" placeholder="Postal" autocomplete="postal-code" maxlength="7"/>
                    </div>
                  </div>

                  <div class="grid-housing3 mt-2" id="housing-row">
                    <div>
                      <label id="housingLabel" for="housingPayment" class="label mb-1 block">Monthly Payment <span class="text-red-500">*</span></label>
                      <input type="text" id="housingPayment" name="housingPayment" class="form-input" placeholder="$1,500" inputmode="numeric" maxlength="16" required/>
                    </div>
                    <div>
                      <label class="label mb-1 block">Rent or Own? <span class="text-red-500">*</span></label>
                      <div class="seg">
                        <button type="button" class="seg-btn" id="btnRent" aria-pressed="true">Rent</button>
                        <button type="button" class="seg-btn" id="btnOwn" aria-pressed="false">Own</button>
                      </div>
                      <input type="hidden" id="housingType" name="housingType" value="Rent" />
                    </div>
                    <div id="addr-duration">
                      <label class="label mb-1 block">Time there <span class="text-zinc-500">(Years &amp; Months)</span> <span class="text-red-500">*</span></label>
                      <div class="tenure-2">
                        <select id="timeAtAddressYears" name="timeAtAddressYears" class="form-select"><option value="">Years</option></select>
                        <select id="timeAtAddressMonths" name="timeAtAddressMonths" class="form-select"><option value="">Months</option></select>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- CONSENT & SUBMIT -->
              <section class="form-step hidden" data-step="99" id="step-consent">
                <div class="step-inner">
                  <div id="consent-checkbox">
                    <div class="flex items-start gap-2 bg-gray-100 p-3 rounded-lg">
                      <input id="creditConsent" name="creditConsent" type="checkbox" class="h-4 w-4 rounded border-gray-300 mt-0.5"/>
                      <label for="creditConsent" id="consentLabel" class="text-[11px] text-zinc-700">
                        I consent to a credit inquiry by Blake Stolth / Vancouver Island Credit to assess financing options and confirm the information provided is accurate. <span class="text-red-500 font-bold">*</span>
                      </label>
                    </div>
                  </div>
                  <p class="text-[11px] text-zinc-500 mt-2">
                    Your info stays private — we never share or sell your data.
                  </p>
                  <div class="pt-2">
                    <button type="submit" id="submitBtn" class="w-full cta-button">Submit and See Options</button>
                    <p id="form-status" class="mt-2 text-[11px] text-center text-red-600" aria-live="polite"></p>
                  </div>
                </div>
              </section>
            </form>
          </div>

          <!-- FOOTER (Next / Back) -->
          <div class="form-footer flex items-center justify-between">
            <button type="button" id="btnBack" class="text-[12px] font-semibold text-zinc-600 hover:text-zinc-900 px-2 py-1 disabled:opacity-30">Back</button>
            <button type="button" id="btnNext" class="cta-button">Next</button>
          </div>
        </div>
      </div>

      <!-- SIDEBAR -->
      <aside class="md:col-span-1 flex flex-col" id="sidebar">
        <div class="powered-card flex-1 flex items-center justify-center p-4">
          <div class="text-center">
            <div class="text-[11px] uppercase tracking-wide text-zinc-500 font-semibold">Powered by</div>
            <img class="equifax-logo mx-auto mt-2" src="Equifax.png" alt="Equifax"/>
          </div>
        </div>

        <div class="card p-5 mt-4 h-fit" id="resume">
          <div class="flex flex-col gap-2">
            <h3 class="h2">Already have an application code?</h3>
            <p class="text-[12px] text-zinc-600">Enter your code to resume.</p>
            <form id="code-form" class="flex items-center gap-2 w-full">
              <input
                id="appCodeInput"
                type="text"
                inputmode="text"
                autocomplete="one-time-code"
                placeholder="ABC1234"
                class="form-input uppercase"
                maxlength="7"
                aria-label="Application code"
              />
              <button type="submit" class="cta-button">Resume</button>
            </form>
            <p id="code-error" class="text-[11px] text-red-600 hidden">Enter a valid code (ABC + 4 digits, e.g., ABC1234).</p>
            <p class="text-[11px] text-zinc-500">Tip: You’ll get this code on the confirmation page after you submit.</p>
          </div>
        </div>
      </aside>
    </section>

    <!-- INVENTORY -->
    <section id="inventory" class="card p-5 mt-6">
      <div class="flex items-center justify-between mb-2">
        <h3 class="h2">Browse by Vehicle Type</h3>
        <a href="#lead-form" class="text-[12px] font-semibold text-[var(--blue-600)] hover:underline js-view-inventory">
          View all <span id="inv-total" class="inv-badge text-zinc-400 font-bold">(0)</span>
        </a>
      </div>
      <p class="text-[12px] text-zinc-600 mb-1">Fill out the quick form above to see your personalized options.</p>
      <p class="text-[11px] text-zinc-500 -mt-1">Numbers refresh as you complete the short form.</p>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mt-3">
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Coupe.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Coupe <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Hatchback.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Hatchback / Wagen <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Electric.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Electric / Hybrid <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Sedan.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Sedan <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Crossover.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Crossover <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Suv.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">SUV <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Van.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Van <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
        <a href="#lead-form" class="bodytype-card js-view-inventory"><div class="bodytype-img" style="background-image:url('Truck.jpg');"></div><div class="p-2"><p class="font-semibold text-[13px]">Truck <span class="inv-badge text-zinc-400 font-semibold">(0)</span></p></div></a>
      </div>
    </section>

    <!-- MAP -->
    <section id="map" class="card p-0 mt-6 overflow-hidden">
      <div class="px-4 py-3">
        <h3 class="h2">Head Office — Victoria, BC</h3>
        <p class="text-[12px] text-zinc-600 mt-1">Real location. Real people. No call centres.</p>
      </div>
      <iframe class="map-embed" title="Map — Vancouver Island Credit" loading="lazy" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps?q=Victoria,BC&z=11&output=embed"></iframe>
      <div class="px-4 py-3 text-[12px] text-zinc-600 border-t">525 Gorge Rd E, Victoria, BC V8T 4T2</div>
    </section>

    <footer id="contact" class="text-center text-[11px] text-zinc-500 pt-1 space-y-1">
      <p class="font-semibold text-zinc-600">Vancouver Island Credit</p>
      <p>525 Gorge Rd E, Victoria, BC V8T 4T2</p>
      <p><a href="tel:2369692424" class="hover:text-[var(--blue-600)] transition-colors">Customer service: 2369692424</a></p>
      <p class="pt-1">Serving Vancouver Island & British Columbia • Delivery available province-wide</p>
      <p class="mt-1">© <span id="year"></span> Vancouver Island Credit • All rights reserved</p>
    </footer>
  </main>

  <!-- Progress overlay -->
  <div id="progress-overlay" class="progress-overlay" aria-hidden="true">
    <div class="progress-card">
      <div class="progress-title">Working on it…</div>
      <div class="progress-track"><div id="progress-bar" class="progress-bar"></div></div>
      <ul id="progress-steps" class="progress-steps">
        <li class="active">Submitting your application…</li>
        <li>Verifying your information…</li>
        <li>Finding the best options…</li>
      </ul>
      <p class="progress-note">Secure &amp; encrypted. We never share or sell your info.</p>
    </div>
  </div>

  <!-- BODY STYLE → OPTION GRID drawer -->
  <div id="gridBackdrop" class="backdrop"></div>
  <aside id="optionGrid" class="sheet">
    <div class="p-3 border-b flex items-center justify-between">
      <div class="h2">Select an Option</div>
      <button id="closeGrid" class="text-[12px] font-semibold text-zinc-600 hover:text-zinc-900">Close</button>
    </div>
    <div class="p-3">
      <p id="gridTitle" class="text-[12px] text-zinc-600 mb-2">Body style: —</p>
      <div id="grid" class="option-grid"></div>
      <p class="text-[11px] text-zinc-500 mt-2">Tip: options are curated privately for your application.</p>
    </div>
  </aside>

  <!-- TWO-PANEL OFFER drawer -->
  <div id="offerBackdrop" class="backdrop"></div>
  <aside id="offerDrawer" class="sheet right">
    <div class="p-3 border-b flex items-center justify-between">
      <div>
        <div class="h2" id="offerTitle">Offer</div>
        <div class="text-[12px] text-zinc-600" id="offerSub">—</div>
      </div>
      <button id="closeOffer" class="text-[12px] font-semibold text-zinc-600 hover:text-zinc-900">Close</button>
    </div>

    <div class="p-3 offer-wrap">
      <div class="offer-left">
        <div class="gallery">
          <div id="galleryMain" class="gallery-main"></div>
          <div id="galleryStrip" class="gallery-strip"></div>
        </div>
      </div>

      <div class="offer-right">
        <div class="flex items-center justify-between mb-2">
          <div class="offer-tabs" id="offerTabs" role="tablist" aria-label="Offer versions"></div>
          <div class="text-[11px] text-zinc-500" id="offerUpdated">Updated just now</div>
        </div>
        <div id="offerFields"></div>
        <div class="mt-3 flex gap-2">
          <a href="#contact" class="cta-button">Message Blake</a>
          <a href="#lead-form" class="px-3 py-2 border rounded-lg text-[12px] font-semibold text-zinc-700 hover:bg-zinc-50">Request a call</a>
        </div>
        <p class="text-[11px] text-zinc-500 mt-2">Private to your login. Numbers and availability change as lenders reply.</p>
      </div>
    </div>
  </aside>

  <!-- Zoom overlay -->
  <div id="zoom" class="zoom-backdrop"><img id="zoomImg" class="zoom-img" alt="Zoomed image"/></div>

  <script>
    // ===== Helpers
    const $ = id => document.getElementById(id);
    const qs = (s, r=document)=>r.querySelector(s);
    const qsa = (s, r=document)=>Array.from(r.querySelectorAll(s));

    // ===== App code handling (ABC + 4 digits)
    function getApplicationCode(){
      const s = sessionStorage.getItem('application_code');
      if (s) return s;
      const urlc = new URL(location.href).searchParams.get('code');
      return urlc || null;
    }
    function isSignedIn(){ return !!getApplicationCode(); }
    function makeApplicationCode(){
      // ABC followed by 4 digits, no hyphen (e.g., ABC1234)
      const n = Math.floor(Math.random()*10000); // 0..9999
      return 'ABC' + String(n).padStart(4,'0');
    }
    function isValidCode(c){ return /^ABC\d{4}$/.test(c); }

    // ===== Mobile menu
    $('menuBtn')?.addEventListener('click', ()=> $('mobileMenu')?.classList.toggle('hidden'));

    // ===== Steps + progress
    const stepsEls = ()=> qsa('.form-step');
    function renumberSteps(){
      const total = stepsEls().length;
      const cur = window.__currentStep || 1;
      $('#progress-label').textContent = 'Step ' + cur + ' of ' + total;
      const pct = Math.round((cur-1)/(total-1)*100);
      $('#progress-fill').style.width = pct + '%';
    }
    function showStep(n){
      const s = stepsEls();
      s.forEach(x=> x.classList.add('hidden'));
      const t = s[n-1];
      if (t){ t.classList.remove('hidden'); window.__currentStep = n; }
      const total = s.length;
      $('#btnBack').disabled = (n === 1);
      $('#btnNext').textContent = (n === total) ? 'See My Options' : 'Next';
      $('#progress-label').textContent = 'Step ' + n + ' of ' + total;
      const pct = Math.round((n-1)/(total-1)*100);
      $('#progress-fill').style.width = pct + '%';
      $('#progress-endcap').textContent = (n === total) ? 'See options you’re actually qualified for' : 'Let’s get you approved';
    }
    function next(delta){
      const cur = window.__currentStep || 1;
      if (delta>0 && !validateStep(cur)) return;
      let t = cur + delta;
      const total = stepsEls().length;
      if (t < 1) t = 1;
      if (t > total) { submitForm(); return; }
      showStep(t);
    }
    $('#btnNext').addEventListener('click', ()=> next(1));
    $('#btnBack').addEventListener('click', ()=> next(-1));

    // ===== Faux refresh
    function fakeRefreshCounts(){
      const badgeAll = qs('#inv-total');
      const badges = [ ...qsa('.inv-badge') ];
      const cards = qsa('.bodytype-card');
      badgeAll?.classList.add('updating'); badges.forEach(b=>b.classList.add('updating')); cards.forEach(c=>c.classList.add('loading'));
      setTimeout(()=>{ badgeAll?.classList.remove('updating'); badges.forEach(b=>b.classList.remove('updating')); cards.forEach(c=>c.classList.remove('loading')); }, 700);
    }

    // ===== Selections
    qsa('[data-type]').forEach(b=> b.addEventListener('click', ()=>{
      $('#vehicleType').value = b.dataset.type;
      qsa('[data-type]').forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected'); fakeRefreshCounts(); next(1);
    }));
    qsa('[data-cond]').forEach(b=> b.addEventListener('click', ()=>{
      $('#vehicleCondition').value = b.dataset.cond;
      qsa('[data-cond]').forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected'); fakeRefreshCounts(); next(1);
    }));
    qsa('[name="budgetRange"]').forEach(r=>{
      r.addEventListener('change', ()=> { fakeRefreshCounts(); next(1); });
      r.parentElement.addEventListener('click', ()=>{ r.checked=true; fakeRefreshCounts(); next(1); });
    });

    // ===== Phone format
    $('#phone')?.addEventListener('input', (e)=>{
      const d=e.target.value.replace(/\D/g,'').slice(0,10);
      if(d.length>6)e.target.value=`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
      else if(d.length>3)e.target.value=`(${d.slice(0,3)}) ${d.slice(3)}`;
      else if(d.length>0)e.target.value=`(${d}`;
    });

    // ===== Rent/Own
    function setHousing(type){
      $('#housingType').value = type;
      $('#btnRent').setAttribute('aria-pressed', String(type==='Rent'));
      $('#btnOwn').setAttribute('aria-pressed', String(type==='Own'));
    }
    $('#btnRent')?.addEventListener('click', ()=> setHousing('Rent'));
    $('#btnOwn')?.addEventListener('click', ()=> setHousing('Own'));

    // ===== Trade-in
    $('#hasTradeIn')?.addEventListener('change', (e)=>{
      qs('#tradeInDetails').classList.toggle('hidden', e.target.value.toLowerCase()!=='yes');
    });

    // ===== Income branching
    $('#incomeSourceFull')?.addEventListener('change', ()=>{
      const v = $('#incomeSourceFull').value;
      const employed = (v === 'Full-Time' || v === 'Part-Time');
      const selfEmp = (v === 'Self-Employed');
      const other = (v === 'Disability' || v === 'Other');

      ['currentEmployer','jobTitle','timeWithEmployerYears','timeWithEmployerMonths','businessName','selfMonthlyIncome','otherIncomeAmount','otherIncomeSource','avgMonthlyIncome'].forEach(id => { const n=$(id); if(n) n.required=false; });

      qs('#empWrap').classList.toggle('hidden', !employed);
      qs('#posWrap').classList.toggle('hidden', !employed);
      qs('#monthlyWrap').classList.toggle('hidden', !employed);
      qs('#tenureWrap').classList.toggle('hidden', !employed);

      qs('#full-self').classList.toggle('hidden', !selfEmp);
      qs('#full-other').classList.toggle('hidden', !other);

      if (employed){
        ['currentEmployer','jobTitle','timeWithEmployerYears','timeWithEmployerMonths','avgMonthlyIncome'].forEach(id => $(id).required = true);
      } else if (selfEmp){
        ['businessName','selfMonthlyIncome'].forEach(id => $(id).required = true);
      } else if (other){
        ['otherIncomeAmount','otherIncomeSource'].forEach(id => $(id).required = true);
      }
      checkPrevEmploymentNeed();
    });

    // ===== Dynamic previous employment
    function ensurePrevEmploymentStep(need){
      const after = $('#step-income');
      const existing = after.nextElementSibling && after.nextElementSibling.querySelector?.('#previousEmployer') ? after.nextElementSibling : null;

      if (need && !existing){
        const sec = document.createElement('section');
        sec.className = 'form-step hidden';
        sec.innerHTML = `
          <div class="step-inner">
            <h3 class="h2 mb-2">Previous employment</h3>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label for="previousEmployer" class="label mb-1 block">Previous employer <span class="text-red-500">*</span></label>
                <input type="text" id="previousEmployer" name="previousEmployer" class="form-input" placeholder="Company" maxlength="80"/>
              </div>
              <div>
                <label class="label mb-1 block">Time there <span class="text-red-500">*</span></label>
                <div class="tenure-2">
                  <select id="prevTimeWithEmployerYears" name="prevTimeWithEmployerYears" class="form-select"><option value="">Years</option></select>
                  <select id="prevTimeWithEmployerMonths" name="prevTimeWithEmployerMonths" class="form-select"><option value="">Months</option></select>
                </div>
              </div>
            </div>
          </div>`;
        after.insertAdjacentElement('afterend', sec);
        populateDropdown(qs('#prevTimeWithEmployerYears'), 0, 30, 'Years', 'Year');
        populateDropdown(qs('#prevTimeWithEmployerMonths'), 0, 11, 'Months', 'Month');
        ['previousEmployer','prevTimeWithEmployerYears','prevTimeWithEmployerMonths'].forEach(id => $(id).required = true);
        const prevIdx = window.__currentStep || 1; renumberSteps(); showStep(prevIdx); return;
      }
      if (!need && existing){
        const prevIdx = window.__currentStep || 1; existing.remove();
        ['previousEmployer','prevTimeWithEmployerYears','prevTimeWithEmployerMonths'].forEach(id => { const n=$(id); if(n) n.required=false; });
        renumberSteps(); const total = stepsEls().length; showStep(Math.min(prevIdx, total)); return;
      }
      ['previousEmployer','prevTimeWithEmployerYears','prevTimeWithEmployerMonths'].forEach(id=>{ const n = $(id); if(n) n.required = !!need; });
    }
    function checkPrevEmploymentNeed(){
      const v = $('#incomeSourceFull').value;
      const employed = (v === 'Full-Time' || v === 'Part-Time');
      const y = parseInt(($('#timeWithEmployerYears').value || '0'),10);
      const m = parseInt(($('#timeWithEmployerMonths').value || '0'),10);
      const months = (y*12)+m;
      const need = employed && (y!==null || m!==null) && months < 24;
      ensurePrevEmploymentStep(need);
    }
    $('#timeWithEmployerYears')?.addEventListener('change', checkPrevEmploymentNeed);
    $('#timeWithEmployerMonths')?.addEventListener('change', checkPrevEmploymentNeed);

    // ===== Dynamic previous address
    function ensurePrevAddressStep(need){
      const after = $('#step-address');
      const existing = after.nextElementSibling && after.nextElementSibling.querySelector?.('#prevStreetAddress') ? after.nextElementSibling : null;

      if (need && !existing){
        const sec = document.createElement('section');
        sec.className = 'form-step hidden';
        sec.innerHTML = `
          <div class="step-inner">
            <h3 class="h2 mb-2">Previous address</h3>
            <div class="grid-addr5">
              <input type="text" id="prevStreetAddress" name="prevStreetAddress" class="form-input" placeholder="Street Address" maxlength="120"/>
              <input type="text" id="prevUnit" name="prevUnit" class="form-input" placeholder="Unit #" maxlength="10"/>
              <input type="text" id="prevCity" name="prevCity" class="form-input" placeholder="City" maxlength="60"/>
              <select id="prevProvince" name="prevProvince" class="form-select"><option value="">Prov</option></select>
              <input type="text" id="prevPostalCode" name="prevPostalCode" class="form-input" placeholder="Postal" maxlength="7"/>
            </div>
            <div class="mt-2">
              <label class="label mb-1 block">Time at previous address <span class="text-red-500">*</span></label>
              <div class="tenure-2">
                <select id="prevTimeAtAddressYears" name="prevTimeAtAddressYears" class="form-select"><option value="">Years</option></select>
                <select id="prevTimeAtAddressMonths" name="prevTimeAtAddressMonths" class="form-select"><option value="">Months</option></select>
              </div>
            </div>
          </div>`;
        after.insertAdjacentElement('afterend', sec);
        populateProvinces(qs('#prevProvince'));
        populateDropdown(qs('#prevTimeAtAddressYears'), 0, 30, 'Years', 'Year');
        populateDropdown(qs('#prevTimeAtAddressMonths'), 0, 11, 'Months', 'Month');
        ['prevStreetAddress','prevCity','prevProvince','prevPostalCode','prevTimeAtAddressYears','prevTimeAtAddressMonths'].forEach(id => $(id).required = true);
        const prevIdx = window.__currentStep || 1; renumberSteps(); showStep(prevIdx); return;
      }
      if (!need && existing){
        const prevIdx = window.__currentStep || 1; existing.remove();
        ['prevStreetAddress','prevCity','prevProvince','prevPostalCode','prevTimeAtAddressYears','prevTimeAtAddressMonths'].forEach(id=>{ const n=$(id); if(n) n.required=false; });
        renumberSteps(); const total = stepsEls().length; showStep(Math.min(prevIdx, total)); return;
      }
      ['prevStreetAddress','prevCity','prevProvince','prevPostalCode','prevTimeAtAddressYears','prevTimeAtAddressMonths'].forEach(id=>{
        const n = $(id); if(n) n.required = !!need;
      });
    }
    function onAddressDurationChange(){
      const y = parseInt(($('#timeAtAddressYears').value || '0'),10);
      const m = parseInt(($('#timeAtAddressMonths').value || '0'),10);
      const months = (y*12)+m;
      const need = (y!==null || m!==null) && months < 24;
      ensurePrevAddressStep(need);
    }
    $('#timeAtAddressYears')?.addEventListener('change', onAddressDurationChange);
    $('#timeAtAddressMonths')?.addEventListener('change', onAddressDurationChange);

    // ===== Validation
    function visibleRequired() {
      const req = qsa('#the-form [required]');
      return req.filter(el => !el.closest('.hidden') && window.getComputedStyle(el).display !== 'none');
    }
    function validateStep(n){
      const stepEl = stepsEls()[n-1]; if(!stepEl) return true;
      let ok = true;
      const fields = visibleRequired().filter(el => stepEl.contains(el));
      fields.forEach(el => {
        let pass = (el.type==='checkbox') ? el.checked : (el.value && el.value.trim()!=='');
        if (el.id==='phone') pass = el.value.replace(/\D/g,'').length>=10;
        if (el.type==='email' || el.id==='email'){ const v=el.value.trim(); pass = pass && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
        if (!pass){ ok=false; el.classList.add('err'); const lab = qs('label[for="'+el.id+'"]'); lab?.classList.add('err-label'); }
        else { el.classList.remove('err'); const lab = qs('label[for="'+el.id+'"]'); lab?.classList.remove('err-label'); }
      });
      return ok;
    }
    function validateAll(){ let ok = true; for (let i=1;i<=stepsEls().length;i++){ if(!validateStep(i)) ok=false; } return ok; }

    // ===== Progress overlay
    async function runProgressOverlay(minMs=4600){
      const overlay = $('#progress-overlay');
      const bar = $('#progress-bar');
      const stepsEl = qsa('#progress-steps li');
      overlay.style.display='flex';
      const stages = [
        { width: 30, index: 0, ms: 1100 },
        { width: 65, index: 1, ms: 1400 },
        { width: 100, index: 2, ms: 1600 }
      ];
      const t0 = Date.now();
      for (const st of stages){
        stepsEl.forEach((li,i)=> li.classList.toggle('active', i===st.index));
        requestAnimationFrame(()=> bar.style.width = st.width + '%');
        await new Promise(r=>setTimeout(r, st.ms));
      }
      const elapsed = Date.now() - t0;
      if (elapsed < minMs) await new Promise(r=>setTimeout(r, minMs - elapsed));
      overlay.style.display='none';
    }

    // ===== Submit
    async function submitForm(){
      if (!validateAll()) { qs('#form-status').textContent = 'Please complete all required fields.'; return; }
      const btn = $('#submitBtn'); if (btn){ btn.disabled = true; btn.textContent = 'Submitting…'; }
      const code = makeApplicationCode();
      try { sessionStorage.setItem('application_code', code); } catch(_) {}

      const fd = new FormData($('#the-form')); fd.append('appCode', code);
      const post = fetch('/', {
        method:'POST',
        headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body:new URLSearchParams(fd).toString()
      }).catch(()=>null);

      await runProgressOverlay(4600);
      try {
        await post;
        const url = new URL('/thank-you.html', window.location.origin);
        url.searchParams.set('code', code);
        window.location.href = url.toString();
      } catch (e) {
        $('#the-form').submit();
      }
    }

    // ===== Inventory “View all” scroll
    qsa('.js-view-inventory').forEach(el=>{
      el.addEventListener('click', (e)=>{
        e.preventDefault(); fakeRefreshCounts();
        document.getElementById('lead-form')?.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    // ===== Resume code form (sidebar)
    $('#code-form')?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const raw = $('#appCodeInput').value || '';
      const code = raw.toUpperCase().replace(/[^A-Z0-9]/g,'').trim();
      const err = $('#code-error');
      if (!isValidCode(code)){ err.classList.remove('hidden'); return; }
      err.classList.add('hidden');
      try { sessionStorage.setItem('application_code', code); } catch(_) {}
      const url = new URL(window.location.href); url.searchParams.set('code', code); history.replaceState(null, '', url.toString());
      document.getElementById('lead-form')?.scrollIntoView({behavior:'smooth', block:'start'});
    });

    // ===== Dropdown helpers
    function populateMonths(sel){ if(!sel) return;
      const m=["01","02","03","04","05","06","07","08","09","10","11","12"];
      m.forEach((mm,i)=>{ const o=document.createElement('option'); o.value=i+1; o.textContent=mm; sel.appendChild(o);});
    }
    function updateDays(){
      const y=parseInt($('#dobYear').value||'',10);
      const m=parseInt($('#dobMonth').value||'',10);
      const sel=parseInt($('#dobDay').value||'',10);
      const days=(y&&m)?new Date(y,m,0).getDate():31;
      $('#dobDay').innerHTML='<option value="">DD</option>';
      for(let i=1;i<=days;i++){ const o=document.createElement('option'); o.value=i; o.textContent=String(i).padStart(2,'0'); $('#dobDay').appendChild(o);}
      if(sel&&sel<=days)$('#dobDay').value=sel;
    }
    function populateDropdown(sel,start,end,label,singular){ if(!sel) return; sel.innerHTML='<option value="">'+(singular||label)+'</option>'; for(let i=start;i<=end;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; sel.appendChild(o);} }
    function populateProvinces(sel){ if(!sel) return; const prov=["AB","BC","MB","NB","NL","NS","NT","NU","ON","PE","QC","SK","YT"]; sel.innerHTML='<option value="">Prov</option>'; prov.forEach(p=>{ const o=document.createElement('option'); o.value=p; o.textContent=p; sel.appendChild(o); }); }

    // ===== Sidebar height sync
    function syncSidebarHeight(){
      const shell = $('#form-shell'); const sidebar = $('#sidebar'); if (!shell || !sidebar) return;
      if (window.matchMedia('(min-width: 768px)').matches){ sidebar.style.height = shell.offsetHeight + 'px'; } else { sidebar.style.height = 'auto'; }
    }
    function calibrateShellHeight(){
      const shell = $('#form-shell'); const header = shell.querySelector('.sticky'); const footer = qs('.form-footer'); const step = $('#step-yourinfo');
      const wasHidden = step.classList.contains('hidden'); if (wasHidden) step.classList.remove('hidden');
      const inner = step.querySelector('.step-inner'); const contentH = inner ? inner.offsetHeight : step.offsetHeight;
      if (wasHidden) step.classList.add('hidden');
      const shellH = header.offsetHeight + contentH + footer.offsetHeight;
      shell.style.height = shellH + 'px'; qs('#step-viewport').style.height = contentH + 'px'; syncSidebarHeight();
    }

    // ===== Drawers (grid & offer)
    const gridSheet = $('#optionGrid'), gridBackdrop = $('#gridBackdrop');
    const offerSheet = $('#offerDrawer'), offerBackdrop = $('#offerBackdrop');
    function openGrid(){ gridSheet.classList.add('open'); gridBackdrop.classList.add('open'); }
    function closeGrid(){ gridSheet.classList.remove('open'); gridBackdrop.classList.remove('open'); }
    function openOffer(){ offerSheet.classList.add('open'); offerBackdrop.classList.add('open'); }
    function closeOffer(){ offerSheet.classList.remove('open'); offerBackdrop.classList.remove('open'); }
    $('#closeGrid').onclick = closeGrid; $('#closeOffer').onclick = closeOffer;
    gridBackdrop.onclick = closeGrid; offerBackdrop.onclick = closeOffer;

    // ===== Body Style cards → Option Grid (only when signed in)
    qsa('.bodytype-card').forEach(card=>{
      card.addEventListener('click', (e)=>{
        if (!isSignedIn()) return; // anchor already goes to form if not
        e.preventDefault();
        const label = card.textContent.trim().split('(')[0].trim();
        showOptionGrid(label);
      });
    });

    // ===== LocalStorage data model (per application code)
    // Structure: localStorage["offers"] = { "<CODE>": { "<BodyStyle>": { "1": {...}, ... } } }
    function readOffers(){ try{ return JSON.parse(localStorage.getItem('offers')||'{}'); }catch(_){ return {}; } }
    function writeOffers(obj){ localStorage.setItem('offers', JSON.stringify(obj)); }
    function ensurePath(code, body){
      const db = readOffers(); db[code] ||= {}; db[code][body] ||= {}; writeOffers(db); return db;
    }

    // ===== Option Grid (1–8)
    function showOptionGrid(bodyStyle){
      const code = getApplicationCode();
      ensurePath(code, bodyStyle);
      const db = readOffers(); const data = db[code][bodyStyle];
      $('#gridTitle').textContent = 'Body style: ' + bodyStyle;

      const grid = $('#grid'); grid.innerHTML = '';
      for (let i=1;i<=8;i++){
        const row = data[String(i)];
        const tile = document.createElement('button');
        tile.className = 'opt-tile'; tile.type = 'button';
        tile.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="opt-h">Option ${i}</div>
            ${(row && row.versions && row.versions.B) ? '<span class="opt-pill">A/B</span>' : ''}
          </div>
          <div class="opt-sub">${row && row.published ? summarize(row) : (adminMode() ? 'Add details' : 'Coming soon')}</div>
        `;
        tile.addEventListener('click', ()=>{
          if (!data[String(i)] || !data[String(i)].published){
            if (adminMode()){
              adminFillOption({code, bodyStyle, idx:i}); showOptionGrid(bodyStyle);
            } else { return; }
          } else { showOfferView({code, bodyStyle, idx:i}); }
        });
        grid.appendChild(tile);
      }
      openGrid();
    }
    function summarize(row){
      const A = row.versions?.A || [];
      const map = Object.fromEntries(A.map(f=>[f.key.toLowerCase(), f.val]));
      const bw = map['bi-weekly payment'] || map['bi-weekly'] || '';
      const term = map['term length'] || map['term'] || '';
      const w1 = A.find(f=>f.key.toLowerCase().startsWith('warranty'))?.val || '';
      const parts = [bw, term, w1].filter(Boolean);
      return parts.length ? parts.join(' • ') : 'Ready';
    }

    // ===== Offer View (Two-panel)
    function showOfferView({code, bodyStyle, idx}){
      const db = readOffers(); const row = db?.[code]?.[bodyStyle]?.[String(idx)];
      if (!row) return;

      $('#offerTitle').textContent = `${bodyStyle} — Option ${idx}`;
      $('#offerSub').textContent = (row.versions?.B) ? 'Two versions available' : 'Single version';
      $('#offerUpdated').textContent = 'Updated ' + timeAgo(row.updatedAt || Date.now());

      const imgs = Array.isArray(row.images) && row.images.length ? row.images : ['https://via.placeholder.com/800x600?text=Vehicle'];
      const main = $('#galleryMain'); const strip = $('#galleryStrip'); strip.innerHTML = '';
      let cur = 0;
      function setMain(i){ cur = i; main.style.backgroundImage = `url("${imgs[i]}")`; qsa('.gallery-thumb', strip).forEach((t,j)=> t.classList.toggle('active', j===i)); }
      imgs.forEach((url,i)=>{ const th = document.createElement('div'); th.className='gallery-thumb'; th.style.backgroundImage=`url("${url}")`; th.onclick=()=>setMain(i); strip.appendChild(th); });
      setMain(0);
      main.onclick = ()=> openZoom(imgs[cur]);

      const tabs = $('#offerTabs'); const fields = $('#offerFields'); tabs.innerHTML=''; fields.innerHTML='';
      const versions = row.versions || {}; const names = Object.keys(versions); const defaultSel = names.includes('A') ? 'A' : names[0];
      names.forEach(name=>{
        const b = document.createElement('button'); b.className='offer-tab'; b.textContent='Offer '+name; b.setAttribute('role','tab'); b.setAttribute('aria-pressed', String(name===defaultSel));
        b.onclick=()=>{ qsa('.offer-tab', tabs).forEach(t=>t.setAttribute('aria-pressed','false')); b.setAttribute('aria-pressed','true'); renderFields(versions[name]); };
        tabs.appendChild(b);
      });
      if (!names.length){ const b=document.createElement('button'); b.className='offer-tab'; b.textContent='Offer'; b.setAttribute('aria-pressed','true'); tabs.appendChild(b); }
      renderFields(versions[defaultSel] || []);
      closeGrid(); openOffer();

      function renderFields(arr){
        fields.innerHTML=''; (arr||[]).forEach(f=>{ const row=document.createElement('div'); row.className='offer-field'; row.innerHTML=`<div class="offer-key">${f.key}</div><div class="offer-val">${f.val}</div>`; fields.appendChild(row); });
      }
    }

    // ===== Zoom
    const zoomEl = $('#zoom'); $('#zoom').addEventListener('click', ()=> zoomEl.style.display='none');
    function openZoom(url){ $('#zoomImg').src = url; zoomEl.style.display='flex'; }

    // ===== Admin mock (only with ?admin=1)
    function adminMode(){ return new URL(location.href).searchParams.get('admin') === '1'; }
    async function adminFillOption({code, bodyStyle, idx}){
      if (!adminMode()) return;
      const imagesCSV = prompt('[Admin] Enter image URLs (comma-separated):', '');
      const twoVersions = confirm('[Admin] Create two versions (A + B)?');

      async function captureVersion(label){
        alert(`[Admin] Enter fields for Offer ${label} in the EXACT order you want them shown.\nCommon keys:\n- Down Payment\n- Bi-Weekly Payment\n- Term Length\n- Warranty 1 (e.g., 3y / 60,000 km)\n- Warranty 2 (optional)`);
        const arr = [];
        while (true){
          const key = prompt(`[Offer ${label}] Field label (blank to finish):`, arr.length===0?'Down Payment':'');
          if (!key) break;
          const val = prompt(`[Offer ${label}] Value for "${key}":`, key.toLowerCase().includes('bi-weekly')?'$289':'');
          if (!val) continue;
          arr.push({key:key.trim(), val:val.trim()});
        }
        return arr;
      }

      const vA = await captureVersion('A');
      const vB = twoVersions ? await captureVersion('B') : null;

      const db = ensurePath(code, bodyStyle);
      db[code][bodyStyle][String(idx)] = {
        published: true,
        images: (imagesCSV||'').split(',').map(s=>s.trim()).filter(Boolean),
        versions: { A: vA, ...(vB?{B:vB}:{}) },
        updatedAt: Date.now()
      };
      writeOffers(db);
      alert('Saved. Option '+idx+' is now published.');
    }

    // ===== Utility
    function timeAgo(t){
      const s = Math.max(1, Math.round((Date.now()-t)/1000));
      if (s<60) return s+'s ago';
      const m = Math.round(s/60); if (m<60) return m+'m ago';
      const h = Math.round(m/60); if (h<24) return h+'h ago';
      const d = Math.round(h/24); return d+'d ago';
    }

    // ===== Init
    (function init(){
      const y = new Date().getFullYear(); qs('#year').textContent = y;

      populateMonths($('#dobMonth')); updateDays();
      $('#dobMonth').addEventListener('change', updateDays);
      $('#dobYear').addEventListener('input', updateDays);

      populateDropdown($('#timeWithEmployerYears'), 0, 30, 'Years', 'Year');
      populateDropdown($('#timeWithEmployerMonths'), 0, 11, 'Months', 'Month');
      populateDropdown($('#timeAtAddressYears'), 0, 30, 'Years', 'Year');
      populateDropdown($('#timeAtAddressMonths'), 0, 11, 'Months', 'Month');
      populateProvinces($('#currentProvince'));

      setHousing('Rent');
      window.__currentStep = 1; showStep(1); renumberSteps();
      requestAnimationFrame(()=> setTimeout(calibrateShellHeight, 0));
      window.addEventListener('resize', ()=> { calibrateShellHeight(); });
      setTimeout(fakeRefreshCounts, 500);

      // Seed example if admin (so the Offer view has something)
      if (adminMode()){
        const code = getApplicationCode() || 'ABC1234';
        const bodyStyle = 'SUV';
        const db = ensurePath(code, bodyStyle);
        if (!db[code][bodyStyle]['1']){
          db[code][bodyStyle]['1'] = {
            published:true,
            images:[
              'https://images.unsplash.com/photo-1549924231-f129b911e442?q=80&w=1200&auto=format&fit=crop',
              'https://images.unsplash.com/photo-1532219413303-9f3fb3e319df?q=80&w=1200&auto=format&fit=crop'
            ],
            versions:{
              A:[
                {key:'Down Payment', val:'$1,000'},
                {key:'Bi-Weekly Payment', val:'$289'},
                {key:'Term Length', val:'72 months'},
                {key:'Warranty 1', val:'3y / 60,000 km'}
              ],
              B:[
                {key:'Down Payment', val:'$0'},
                {key:'Bi-Weekly Payment', val:'$319'},
                {key:'Warranty 1', val:'5y / 100,000 km'},
                {key:'Term Length', val:'84 months'}
              ]
            },
            updatedAt: Date.now()
          };
          writeOffers(db);
        }
      }
    })();

    // Buttons / form handlers wired earlier
  </script>
</body>
</html>
